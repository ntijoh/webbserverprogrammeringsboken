<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<title>Webbserverprogrammeringsboken</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge, pre.rouge .w {
  color: #24292f;
  background-color: #f6f8fa;
}
pre.rouge .k, pre.rouge .kd, pre.rouge .kn, pre.rouge .kp, pre.rouge .kr, pre.rouge .kt, pre.rouge .kv {
  color: #cf222e;
}
pre.rouge .gr {
  color: #f6f8fa;
}
pre.rouge .gd {
  color: #82071e;
  background-color: #ffebe9;
}
pre.rouge .nb {
  color: #953800;
}
pre.rouge .nc {
  color: #953800;
}
pre.rouge .no {
  color: #953800;
}
pre.rouge .nn {
  color: #953800;
}
pre.rouge .sr {
  color: #116329;
}
pre.rouge .na {
  color: #116329;
}
pre.rouge .nt {
  color: #116329;
}
pre.rouge .gi {
  color: #116329;
  background-color: #dafbe1;
}
pre.rouge .ges {
  font-weight: bold;
  font-style: italic;
}
pre.rouge .kc {
  color: #0550ae;
}
pre.rouge .l, pre.rouge .ld, pre.rouge .m, pre.rouge .mb, pre.rouge .mf, pre.rouge .mh, pre.rouge .mi, pre.rouge .il, pre.rouge .mo, pre.rouge .mx {
  color: #0550ae;
}
pre.rouge .sb {
  color: #0550ae;
}
pre.rouge .bp {
  color: #0550ae;
}
pre.rouge .ne {
  color: #0550ae;
}
pre.rouge .nl {
  color: #0550ae;
}
pre.rouge .py {
  color: #0550ae;
}
pre.rouge .nv, pre.rouge .vc, pre.rouge .vg, pre.rouge .vi, pre.rouge .vm {
  color: #0550ae;
}
pre.rouge .o, pre.rouge .ow {
  color: #0550ae;
}
pre.rouge .gh {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .gu {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .sc, pre.rouge .dl, pre.rouge .sd, pre.rouge .s2, pre.rouge .se, pre.rouge .sh, pre.rouge .sx, pre.rouge .s1, pre.rouge .ss {
  color: #0a3069;
}
pre.rouge .nd {
  color: #8250df;
}
pre.rouge .nf, pre.rouge .fm {
  color: #8250df;
}
pre.rouge .err {
  color: #f6f8fa;
  background-color: #82071e;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cm, pre.rouge .cp, pre.rouge .cpf, pre.rouge .c1, pre.rouge .cs {
  color: #6e7781;
}
pre.rouge .gl {
  color: #6e7781;
}
pre.rouge .gt {
  color: #6e7781;
}
pre.rouge .ni {
  color: #24292f;
}
pre.rouge .si {
  color: #24292f;
}
pre.rouge .ge {
  color: #24292f;
  font-style: italic;
}
pre.rouge .gs {
  color: #24292f;
  font-weight: bold;
}
</style>
  <style>
      pre.rouge .hll {
        background-color: #ffc;
        display: block;
      }
      pre.rouge .hll * {
        background-color: initial;
      }
  </style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Webbserverprogrammeringsboken</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_databaser">Databaser</a>
<ul class="sectlevel2">
<li><a href="#_grundläggande_terminologi">Grundläggande terminologi</a></li>
<li><a href="#_tabeller_och_relationer">Tabeller och relationer</a></li>
<li><a href="#_er_diagram">ER-Diagram</a></li>
</ul>
</li>
<li><a href="#_sql">SQL</a>
<ul class="sectlevel2">
<li><a href="#_select">Select</a></li>
<li><a href="#_select_med_join">Select med join</a></li>
<li><a href="#_insert">Insert</a></li>
</ul>
</li>
<li><a href="#_requests_routing">Requests &amp; Routing</a>
<ul class="sectlevel2">
<li><a href="#_formulär_och_get_post_redirect_cykeln">Formulär och GET-POST-Redirect-Cykeln</a></li>
<li><a href="#_formulärbehandlande_routes_i_sinatra">Formulärbehandlande routes i Sinatra</a></li>
<li><a href="#_routes_för_crud">Routes för CRUD</a></li>
<li><a href="#_registrering_inloggning">Registrering &amp; Inloggning</a></li>
</ul>
</li>
<li><a href="#_kakor_kryptering_och_sessioner">Kakor, kryptering och sessioner.</a>
<ul class="sectlevel2">
<li><a href="#_kakor">Kakor</a></li>
<li><a href="#_kryptering">Kryptering</a></li>
<li><a href="#_sessioner">Sessioner</a></li>
<li><a href="#_hashning">Hashning</a></li>
<li><a href="#_salting">Salting</a></li>
</ul>
</li>
<li><a href="#_templates">Templates</a>
<ul class="sectlevel2">
<li><a href="#_formulär">Formulär</a></li>
<li><a href="#_formulär_element">Formulär-element</a></li>
</ul>
</li>
<li><a href="#_arbetsflöde">Arbetsflöde</a></li>
<li><a href="#_automatisk_testning_med_cypress">Automatisk testning med Cypress</a>
<ul class="sectlevel2">
<li><a href="#_installation">Installation</a></li>
<li><a href="#_starta_cypress">Starta Cypress</a></li>
<li><a href="#_skriva_egna_tester">Skriva egna tester</a></li>
</ul>
</li>
<li><a href="#_fil_och_mappstruktur">Fil- och mappstruktur</a>
<ul class="sectlevel2">
<li><a href="#_moduler">Moduler</a></li>
</ul>
</li>
<li><a href="#_linux">Linux</a></li>
<li><a href="#_installation_och_konfigurering">Installation och konfigurering</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_databaser">Databaser</h2>
<div class="sectionbody">
<div class="paragraph">
<p>En databas är en välorganiserad, det vill säga uppbyggd enligt nedskrivna regler, centraliserad, samling av data.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title"><strong>Data</strong> vs <strong>information</strong>.</div>
<div class="paragraph">
<p>Information är behandlad data - det vill säga data som någon kan använda för att tillföra något slags värde i någon slags process eller sammanhang.</p>
</div>
<div class="paragraph">
<p>Man kan säga att data blir information när någon tittar på eller behandlar den.</p>
</div>
</td>
</tr>
</table>
</div>
<h3 id="_typer_av_databaser" class="discrete">Typer av databaser</h3>
<div class="paragraph">
<p>Det finns i dag två huvudsakliga typer av databaser: <strong>Relationsdatabaser</strong> och <strong>dokument/nod-baserade databaser</strong>. Andra ord som används för att skilja på dessa två typer av databaser är <strong>SQL</strong> (relationella) och <strong>NoSQL</strong> (dokument/nod-baserade).</p>
</div>
<div class="paragraph">
<p>I den här kursen kommer vi enbart använda oss av SQL-baserade databaser, det vill säga <strong>Relationsdatabaser</strong>.</p>
</div>
<div class="sect2">
<h3 id="_grundläggande_terminologi">Grundläggande terminologi</h3>
<div class="sect3">
<h4 id="_databashanterare">Databashanterare</h4>
<div class="paragraph">
<p>En Databashanterare/Databashanteringssystem, eller DBMS (Database Management System), är mjukvara som gör det möjligt att på ett effektivt och säkert sätt <strong>definera</strong>, <strong>hämta</strong> och <strong>modifiera</strong> innehåll i en databas.</p>
</div>
<div class="paragraph">
<p>Man kan inte kommunicera direkt med en databas; all kommunikation sker via en databashanterare.</p>
</div>
<div class="paragraph">
<p>I den här kursen kommer vi använda oss av <strong>SQLite</strong> som DBMS.</p>
</div>
</div>
<div class="sect3">
<h4 id="_tabeller_rader_och_kolumner">Tabeller, rader och kolumner</h4>
<div class="paragraph">
<p>En relationsdatabas består av en eller flera <strong>tabeller</strong> Varje tabell har ett namn, och består av <strong>rader</strong> och <strong>kolumner</strong>.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 45%;">
<caption class="title">Table 1. Exempel på en tabell för att hålla koll på böcker</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 60%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock"><strong>books</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>id</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>title</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>page_count</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Catch 22'</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">464</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'To Kill a Mockingbird'</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">336</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'1984'</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">328</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'The Stranger'</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">123</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Tabellen ovan har namnet <code>books</code>, och har 4 rader och 3 kolumner.</p>
</div>
</div>
<div class="sect3">
<h4 id="_entiteter_och_tabeller">Entiteter och tabeller</h4>
<div class="paragraph">
<p>En tabell i en databas kallas för en <strong>entitet</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="_tupler_och_rader">Tupler och rader</h4>
<div class="paragraph">
<p>Varje rad i tabellen kallas för en <strong>tupel</strong> och beskriver en <strong>post</strong> i tabellen.</p>
</div>
<div class="paragraph">
<p>I books-tabellen innehåller varje tupel information om en bok.</p>
</div>
</div>
<div class="sect3">
<h4 id="_attribut_och_kolumner">Attribut och kolumner</h4>
<div class="paragraph">
<p>Varje kolumn beskriver en egenskap, eller <strong>attribut</strong> för posten.</p>
</div>
<div class="paragraph">
<p>I books-entiteten är <code>id</code>, <code>title</code> och <code>page_count</code> attribut.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title"><strong>Attribut måste vara atomära</strong></div>
<div class="paragraph">
<p>Attribut <em>måste</em> vara <strong>atomära</strong>, det vill säga i varje "cell" eller "fält" får det maximalt finnas <em>ett</em> (1) värde - man får t.ex inte lagra flera titlar i en och samma cell.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 70%;">
<caption class="title">Table 2. En <strong>felaktig</strong> tabell med icke-atomära värden i phone_number kolumnen.</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 33.3333%;">
<col style="width: 50.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock"><strong>contacts</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>id</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>name</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>phone_number</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Hermione Granger'</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">"555-123 45 67", "555-234 56 78"</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Ron Weasly'</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">"555-234 56 78"</p></td>
</tr>
</tbody>
</table>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tabeller_och_relationer">Tabeller och relationer</h3>
<div class="paragraph">
<p>En relationsdatabas består av tabeller och relationerna mellan tabellerna.</p>
</div>
<div class="sect3">
<h4 id="_primärnyckel_och_unika_rader">Primärnyckel och unika rader</h4>
<div class="paragraph">
<p>Varje rad i en tabell <em>måste</em> vara unik, det vill säga, i varje tabell får det inte förekomma två rader där samtliga kolumner är identiska.</p>
</div>
<div class="paragraph">
<p>Detta löses enklast genom att varje tabell har ett <em>attribut</em> som kallas för <strong>primärnyckel</strong> eller <strong>primary key</strong>.</p>
</div>
<div class="paragraph">
<p>När man skapar tabellen talar man om vilket av attributen som kommer vara primärnyckeln.</p>
</div>
<div class="paragraph">
<p>I tabellen ovan har den som skapat tabellen valt attributet <code>id</code> som primärnyckel. En primärnyckels värde <em>måste</em> vara unikt för tabellen och kolumnen.</p>
</div>
<div class="paragraph">
<p>Detta innebär att även om det skulle finnas två böcker som heter <em>"The Stranger"</em>, och som båda råkar ha 123 sidor kommer raden fortfarande vara unik, eftersom den kommer få en unikt värde på primärnyckeln.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 45%;">
<caption class="title">Table 3. Varje tupel är fortfarande unik, trots att det finns två böcker med samma titel och sidantal.</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 60%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock"><strong>books</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>id</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>title</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>page_count</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Catch 22'</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">464</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'To Kill a Mockingbird'</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">336</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'1984'</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">328</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'The Stranger'</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">123</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'The Stranger'</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">123</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Databashanterarens (SQLite) kontrollerar att varje primärnyckel/tupel är unik.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Namngivning av primärnyckeln</div>
<div class="paragraph">
<p>I den här kursen kommer vi:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>alltid</strong> använda namnet <strong>id</strong> för primärnyckeln, men primärnyckeln <em>kan</em> heta vad som helst.</p>
</li>
<li>
<p><strong>alltid</strong> använda <strong>automatiskt inkrementerande heltal</strong> för primärnyckeln, men primärnyckeln <em>kan</em> vara vad som helst.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_relationer">Relationer</h4>
<div class="paragraph">
<p>För att knyta samman två tabeller behöver vi skapa en <strong>relation</strong>, det vill säga, en koppling, mellan dem.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 40%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 60%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="3"><p class="tableblock"><strong>books</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>id</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>title</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>page_count</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Catch 22'</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">464</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'To Kill a Mockingbird'</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">336</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'1984'</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">328</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'The Stranger'</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">123</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Closing Time'</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">382</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Animal Farm'</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">218</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'The Plague  '</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">312</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Coming Up for Air'</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">393</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all" style="width: 50%;">
<colgroup>
<col style="width: 11.1111%;">
<col style="width: 33.3333%;">
<col style="width: 22.2222%;">
<col style="width: 22.2222%;">
<col style="width: 11.1112%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong>authors</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>id</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>nationality</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>birth_year</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>shoe_size</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Joseph Heller'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'American'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1923</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">42</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Harper Lee'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'American'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1926</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">36</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'George Orwell'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'English'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1903</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">41</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Albert Camus'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'French'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1913</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">44</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>I exemplet med böcker och författare behöver vi skapa en <strong>en-till-många-relation</strong> mellan authors och books - <em>en</em> författare kan ha skrivit <em>många</em> böcker (men en bok kan bara ha en författare).</p>
</div>
</div>
<div class="sect3">
<h4 id="_främmande_nyckel">Främmande nyckel</h4>
<div class="paragraph">
<p>För att skapa en relation mellan två tabeller använder man en <strong>främmande nyckel</strong>. Man skapar en främmande nyckel genom att kopiera in värdet från  <strong>primärnyckeln</strong> i <strong>en-änden</strong> av relationen i en ny kolumn i <strong>många-änden</strong> av relationen.</p>
</div>
<div class="paragraph">
<p>I vårt fall innebär det att vi ska lägga till primärnyckeln från <strong>author</strong>-tabellen i <strong>books</strong>-tabellen (en för fattare kan ha skrivit flera böcker).</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 40%;">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 37.5%;">
<col style="width: 12.5%;">
<col style="width: 37.5%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>books</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>id</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>title</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><strong>page_count</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>author_id</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Catch 22'</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">464</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'To Kill a Mockingbird'</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">336</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'1984'</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">328</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'The Stranger'</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">123</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Closing Time'</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">382</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Animal Farm'</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">218</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'The Plague  '</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">312</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Coming Up for Air'</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">393</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Namngivning av den främmande nyckeln</div>
<div class="paragraph">
<p>Den främmande nyckelns kolumn kan heta precis vad som helst, men i den här boken kommer den främmande nyckelns kolumn-namn <strong>alltid</strong> döpas enligt följande: <strong>namnet på en-ändens tabellnamn <em>i singular</em></strong> följt av ett understreck och sen <strong>id</strong> (<strong>author_id</strong>)</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_er_diagram">ER-Diagram</h3>
<div class="paragraph">
<p>För att på ett smidigt sätt kunna <em>modellera</em>, det vill säga <em>designa</em> relationsdatabaser finns <em>Entity Relationship Diagrams</em> (ER-diagram).</p>
</div>
<div class="paragraph">
<p>ER-diagram illustrerar en databas logiska uppbyggnad, det vill säga vilka <em>entiteter</em>, <em>attribut</em> och <em>relationer</em> som finns i databasen - det beskriver inte den faktiska datan som lagras i databasen.</p>
</div>
<div class="sect3">
<h4 id="_entitet">Entitet</h4>
<div class="paragraph">
<p>En entitet (engelska: entity) representerar en en typ av sak som lagras i databasen. Entiteter ritas som rektanglar, med namnet (i singular) i mitten.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/databases/images/entities.png" alt="Två entiteter i ett ER-diagram">
</div>
<div class="title">Två entiteter</div>
</div>
</div>
<div class="sect3">
<h4 id="_attribut">Attribut</h4>
<div class="paragraph">
<p>Attribut (engelska: attribute) representerar en egenskap på något som lagras i databasen. Attribut ritas som en ovaler, med namnet i mitten. Alla attribut måste tillhöra en tabell, och man drar ett streck mellan entiteten och attributet för att visa vilken entitet ett attribut tillhör.</p>
</div>
<div class="paragraph">
<p>Om ett attribut på en entitet är unikt för den entiteten, det vill säga, det får i systemet som databasen modellerar inte finnas två saker som har samma värde på det attributet stryker man under det attributet.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/databases/images/entities_with_attributes.png" alt="Två entiteter med attribut i ett ER-diagram">
</div>
<div class="title">Två entiteter med attribut</div>
</div>
<div class="paragraph">
<p><code>Primärnycklarna</code> är alltid understrukna.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>Främmande nycklar</strong></p>
</div>
<div class="paragraph">
<p>Främmande nycklar ska aldrig ritas ut i ER-diagrammet, deras placering framgår av relationerna (se nästa rubrik)</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_sambandstyprelation">Sambandstyp/Relation</h4>
<div class="paragraph">
<p>Sambandstyper (engelska: relation) visar på kopplingar mellan två entiteter. Sambandstyper ritas som romber. I mitten av romben står ett ett eller flera ord som beskriver entiteternas samband (oftast från ena entitetens perspektiv).</p>
</div>
<div class="paragraph">
<p>Varje sambandstyp är kopplad med streck till de ingående entiteterna.</p>
</div>
</div>
<div class="sect3">
<h4 id="_kardinalitetsförhållanden">Kardinalitetsförhållanden</h4>
<div class="paragraph">
<p>I varje ände av en sambandstyp framgår dess <em>kardinalitet</em> (engelska: cardinality), som mer exakt beskriver vad entiteterna har för <em>kardinalitetsförhållanden</em> eller samband.
Det finns tre typer av kardinalitetsförhållanden:</p>
</div>
<div class="sect4">
<h5 id="_ett_till_ett_samband_eller_11_samband">Ett-till-ett-samband (eller 1:1-samband)</h5>
<div class="paragraph">
<p>Ett 1:1-samband innebär att de ingående entiteterna kan höra ihop med <em>ett</em> exempel av entiteten i andra änden av sambandet.</p>
</div>
</div>
<div class="sect4">
<h5 id="_ett_till_många_samband_eller_1_samband">Ett-till-många-samband (eller 1:*-samband)</h5>
<div class="paragraph">
<p>Ett 1:*-samband innebär att de ingående entiteterna kan höra ihop med <em>ett</em> exempel av entiteten i andra änden av sambandet.</p>
</div>
<div class="paragraph">
<p>En sambandstyp där entiteten i den ena änden av sambandet kan höra ihop med flera exempel av entiten i den andra änden, men varje exempel i den andra änden hör bara ihop med ett exempel av den första entiteten.</p>
</div>
</div>
<div class="sect4">
<h5 id="_många_till_många_samband_eller_samband">Många-till-många-samband (eller *:*-samband)</h5>
<div class="paragraph">
<p>Ett *:*-samband innebär att ett exempel av var och en av de ingående entiteterna kan höra ihop med flera exempel av de övriga ingående entiteterna.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/databases/images/entities_with_attributes_and_relations.png" alt="Två entiteter med attribut och sambandstyp i ett ER-diagram">
</div>
<div class="title">Två entiteter med attribut och sambandstyp</div>
</div>
<div class="paragraph">
<p>I exemplet ovan kan man utläsa att <strong>en</strong> författare kan skriva <strong>många</strong> (men minst 1) böcker,
men en bok kan bara ha en författare. Det är med andra ord en en-till-många-samband.</p>
</div>
<div class="paragraph">
<p>Sambandstypen är i exemplet ovan är namngiven från författarens perspektiv ("wrote"), men skulle lika gärna kunna vara skriven från en boks perspektiv (t.ex "written by" eller "belongs to").</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sql">SQL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>För att prata med databashanteraren använder man frågespråket SQL, <strong>S</strong>tructured <strong>Q</strong>uery <strong>L</strong>anguage. SQL kan (på svenska) uttalas "ess-ku-ell", (på engelska) "es-queue-ell", som Engelska ordet "sequel" eller som "seek well".</p>
</div>
<div class="paragraph">
<p>SQL skiljer sig från programmeringsspråk som t.ex Ruby eller Javascript genom att man definerar <em>vilken</em> information man vill ha, och lämnar upp till databashanteraren att avgöra <em>hur</em> den på bästa (snabbaste och säkraste) sätt ska hämta efterfrågad data.</p>
</div>
<div class="paragraph">
<p>Man brukar säga att Ruby (och de flesta andra programmeringsspråk) är <em>imperativa</em>, dvs man säger till datorn hur och i vilken ordning den ska göra något, medan SQL är <em>deklarativt</em>, det vill säga man deklarerar vilket resultat man vill ha och lämnar till "datorn" att avgöra hur den ska uppnå resultatet.</p>
</div>
<div class="listingblock">
<div class="title">Ruby - rad 8-14 beskriver <em>hur</em> datan ska hämtas (i det här fallet med hjälp av en while-loop).</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
</pre></td><td class="code"><pre><span class="n">titles</span> <span class="o">=</span> <span class="p">[</span> <span class="p">{</span><span class="ss">name: </span><span class="s1">'BBQ Book'</span><span class="p">,</span> <span class="ss">isbn: </span><span class="s1">'123'</span><span class="p">,</span> <span class="ss">page_count: </span><span class="mi">1337</span><span class="p">},</span>
          <span class="p">{</span><span class="ss">name: </span><span class="s1">'Grillboken'</span><span class="p">,</span> <span class="ss">isbn: </span><span class="s1">'234'</span><span class="p">,</span> <span class="ss">page_count: </span><span class="mi">42</span><span class="p">},</span>
          <span class="o">...</span>
        <span class="p">]</span>

<span class="n">long_titles</span> <span class="o">=</span> <span class="p">[]</span>

<span class="hll"><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class="hll"><span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">titles</span><span class="p">.</span><span class="nf">length</span>
</span><span class="hll">    <span class="k">if</span> <span class="n">titles</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="ss">:page_count</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">500</span>
</span><span class="hll">        <span class="n">long_titles</span> <span class="o">&lt;&lt;</span> <span class="n">books</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span class="hll">    <span class="k">end</span>
</span><span class="hll">    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class="hll"><span class="k">end</span>
</span>
<span class="nb">p</span> <span class="n">long_titles</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">SQL - <strong>hur</strong> databashanteraren ska hämta den efterfrågade informationen framgår inte i frågan</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">titles</span> <span class="k">WHERE</span> <span class="n">page_count</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">;</span> <i class="conum" data-value="1"></i><b>(1)</b>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Förutsatt att det i databasen finns en tabell vid namn titles</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_select">Select</h3>
<div class="listingblock">
<div class="title">Hämta <em>alla</em> poster från en tabell</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">fruits</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Hämta alla poster från tabell som uppfyller ett givet villkor</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">products</span> <span class="k">WHERE</span> <span class="n">price</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Hämta alla poster från tabell som uppfyller flera villkor</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">songs</span> <span class="k">WHERE</span> <span class="n">play_count</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="k">AND</span> <span class="k">length</span> <span class="o">&lt;</span> <span class="mi">120</span><span class="p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_select_med_join">Select med join</h3>
<div class="paragraph">
<p>För att hämta data från en tabell, samt tillhörande data från en tillhörande tabell behöver man använda sig av <strong>joins</strong>. En join är ett sätt att med en fråga få data från flera tabeller.</p>
</div>
<div class="paragraph">
<p>Kod-exemplen nedan utgår från fruits och ratings. Det finns en <code>fruits</code>-tabell och en <code>ratings</code>-tabell. I ratings-tabellen återfinns <code>fruits</code>-tabellens primärnyckel som en främmande nyckel:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/sql/images/joins_example.png" alt="joins example">
</div>
<div class="title">De två tabellerna och deras koppling</div>
</div>
<div class="paragraph">
<p>När man ska skriva en SQL-join är det enklast om man utvecklar SQL-frågan rad för rad:</p>
</div>
<div class="listingblock">
<div class="title">1. Hämta alla poster från primär-resursen</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
</pre></td><td class="code"><pre> <span class="k">SELECT</span> <span class="o">*</span>
 <span class="k">FROM</span> <span class="n">fruits</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ovanstående fråga  returnerar en array av arrayer:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="p">[</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"apple"</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="s2">"pear"</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="s2">"orange"</span><span class="p">]</span>
<span class="p">]</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">2. Lägg till en join för den tillhörande tabellen</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre> <span class="k">SELECT</span> <span class="o">*</span>
 <span class="k">FROM</span> <span class="n">fruits</span>
<span class="hll"> <span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">ratings</span>
</span></pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ovanstående fråga returnerar också en array av arrayer.
De första två elementen i varje array är värdena från <code>fruits</code>-tabellen. De sista tre elementen i varje array är värden från <code>ratings</code>-tabellen (eftersom det i SQL-frågan först står <code>fruits</code> och sen <code>ratings</code>).</p>
</div>
<div class="paragraph">
<p>Man kan alltså visualisera att arrayen ser ut som följer:</p>
</div>
<div class="paragraph">
<p><code>[&lt;fruits.id&gt;,&lt;fruits.name&gt;,&lt;ratings.id&gt;,&lt;ratings.score&gt;,&lt;ratings.fruit_id&gt;]</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="code"><pre><span class="p">[</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"apple"</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"apple"</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"apple"</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"apple"</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"apple"</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"apple"</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"apple"</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"apple"</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="s2">"pear"</span><span class="p">,</span>   <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="s2">"pear"</span><span class="p">,</span>   <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="s2">"pear"</span><span class="p">,</span>   <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="s2">"pear"</span><span class="p">,</span>   <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="s2">"pear"</span><span class="p">,</span>   <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="s2">"pear"</span><span class="p">,</span>   <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="s2">"pear"</span><span class="p">,</span>   <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="s2">"pear"</span><span class="p">,</span>   <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="s2">"orange"</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="s2">"orange"</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="s2">"orange"</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="s2">"orange"</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="s2">"orange"</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="s2">"orange"</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="s2">"orange"</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="s2">"orange"</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="p">]</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Dessvärre innehåller den returnerade datan en massa nonsens: databashanteraren har, för varje rad i ratings-tabellen, "hittat på" en rad för varje rad i frukt-tabellen (vi har 8 ratings, och 4 frukter, <code>8 * 4 &#8658; 32</code>).</p>
</div>
<div class="paragraph">
<p>Det vi behöver göra nu är att filtrera ut de värden som faktiskt finns i databasen, det vill säga de rader där den <em>främmande</em> nyckeln är samma som <em>primärnyckeln</em> i huvudtabellen.</p>
</div>
<div class="paragraph">
<p>I vårt fall är det alltså <code>fruits_id</code> i <code>ratings</code>-tabellen (det sista elementet i arrayen) som ska vara sammma som <code>id</code> i <code>fruits</code>-tabellen (det första elementet i arrayen).</p>
</div>
<div class="listingblock">
<div class="title">De rader som faktiskt finns i databasen</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="code"><pre><span class="p">[</span>
<span class="hll">    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"apple"</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
</span>    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"apple"</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
<span class="hll">    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"apple"</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
</span>    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"apple"</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
<span class="hll">    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"apple"</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
</span><span class="hll">    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"apple"</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
</span><span class="hll">    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"apple"</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
</span>    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"apple"</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="hll">    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
</span>    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="hll">    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
</span>    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="s2">"pear"</span><span class="p">,</span>   <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="s2">"pear"</span><span class="p">,</span>   <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="s2">"pear"</span><span class="p">,</span>   <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="s2">"pear"</span><span class="p">,</span>   <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="s2">"pear"</span><span class="p">,</span>   <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="s2">"pear"</span><span class="p">,</span>   <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="s2">"pear"</span><span class="p">,</span>   <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="hll">    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="s2">"pear"</span><span class="p">,</span>   <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
</span>    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="s2">"orange"</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="s2">"orange"</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="s2">"orange"</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="s2">"orange"</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="s2">"orange"</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="s2">"orange"</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="s2">"orange"</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="s2">"orange"</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="p">]</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Filtreringen gör vi genom att säga till vilka två kolumner som ska matcha med hjälp av <code>ON</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">fruits</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">ratings</span>
<span class="hll"><span class="k">ON</span> <span class="n">ratings</span><span class="p">.</span><span class="n">fruit_id</span> <span class="o">=</span> <span class="n">fruits</span><span class="p">.</span><span class="n">id</span>
</span></pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Vilket returnerar den filtrerade listan:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="p">[</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"apple"</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"apple"</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"apple"</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"apple"</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"apple"</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="s2">"pear"</span><span class="p">,</span>   <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Om vi slutligen vill begränsa frågan till en specik frukt lägger vi till en <code>WHERE</code> sist i frågan:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre><span class="n">db</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="s1">'SELECT *</span>
<span class="s1">            FROM fruits</span>
<span class="s1">            INNER JOIN ratings</span>
<span class="s1">            ON ratings.fruit_id = fruits.id</span>
<span class="hll"><span class="s1">            WHERE fruits.id = ?'</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Vilket returnerar enbart resultat för frukten med <code>id</code> 2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span class="p">[</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="s2">"banana"</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="p">]</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Joins <em>är</em> jobbiga att komma underfund med, men om man gör dem steg för steg enligt ovan, och testkör frågan för varje steg är det enklare att förstå vad man ska skriva.</p>
</div>
</div>
<div class="sect2">
<h3 id="_insert">Insert</h3>
<div class="paragraph">
<p>För att lagra data i tabeller används <code>INSERT</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">fruits</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">tastiness</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'pear'</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Observera att <code>id</code> inte skickas med. Det skapar databasen själv, baserat på vilka id:n som är upptagna.</td>
</tr>
</table>
</div>
<h3 id="_sql_injection" class="discrete">SQL-Injection</h3>
<div class="paragraph">
<p>SQL är ett gammalt språk från 60-talet, långt innan internet slog igenom. Det är från en enklare tid, när man utgick från att de som kunde skicka data till databasen var välvilliga, och inte ville förstöra eller hämta ut data som de inte egentligen hade rättigheter att komma åt.</p>
</div>
<div class="paragraph">
<p>Därför innehåller SQL en stor säkerhetslucka som gör det möjligt för en illvillig person att köra godtycklig SQL-kod mot databasen (t.ex lista alla användare eller ta bort tabeller) genom en så kallad <strong>SQL-injection</strong> attack. Detta innebär att <strong>all data som kommer från en användare (dvs inte står skriven som statiska värden i källkoden) måste saneras innan de skickas till databashanteraren</strong></p>
</div>
<div class="paragraph">
<p>SQLite3-biblioteket i Ruby löser saneringen genom att man skriver <code>?</code> i SQL-strängen där man vill lägga in värden från användaren, och sen skicka en array av värden som kommer, på ett säkert sätt, ersätta frågetecknen:</p>
</div>
<div class="listingblock">
<div class="title">En (1) parameter från användaren (id)</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre><span class="n">db</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="s1">'SELECT * FROM fruits WHERE id = ?'</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Flera parametrar från användaren (username, password)</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre><span class="n">db</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="s1">'INSERT INTO users (username, password) VALUES (?,?)'</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Vad kan hända om man interpolerar värden direkt från användaren?</p>
</div>
<div class="paragraph">
<p>Anta att du tar emot data från användaren, och datan lagras i variabeln <code>name</code></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>NEDANSTÅENDE ARBETSSÄTT MED INTERPOLERING ÄR ABSOLUT FÖRBJUDET ATT ANVÄNDA SIG AV</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="n">db</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="s2">"SELECT * FROM users WHERE name = </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>name</code> kommer från användaren och interpoleras in i SQL-strängen.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Frågan ser ofarlig ut, men om <code>name</code> innehåller en speciellt formaterad sträng kan vad som helst ske med databasen.</p>
</div>
<div class="listingblock">
<div class="title">Exempel 1: Lista alla poster i tabellen</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="nb">name</span> <span class="o">=</span> <span class="s2">"Haxx0r OR 1 = 1"</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="n">db</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="s2">"SELECT * FROM users WHERE name = </span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="c1">#=&gt; [[1, "user1", "password1"], [2, "user2", "password2"], [3, "user3", "password3"]] </span><i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Strängen innehåller en <code>or</code>-statement där den högra jämförelsen alltid blir sann.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>En <code>SELECT</code> med <code>WHERE</code> returnerar de rader där jämförelsen är <code>true</code>. Men eftersom strängen innehåller en or-statement, och i or-statements behöver bara ena sidan vara <code>true</code>, blir <code>id = 3 OR 1 = 1</code> <em>alltid</em> true. Det databashanteraren ser är alltså <code>SELECT * FROM USERS WHERE true</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Eftersom <code>true</code> är <code>true</code> för alla rader returneras alla rader från tabellen.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Exempel 2: Ta bort en tabell</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="nb">name</span> <span class="o">=</span> <span class="s2">"Haxx0r'; DROP TABLE users; -- "</span>
<span class="n">db</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="s2">"SELECT * FROM users WHERE name = '</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">';"</span>
<span class="n">db</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="s2">"SELECT * FROM users;"</span> <span class="c1">#=&gt; eval error: no such table: users</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Förtydligande kring hur SQL-koden tolkas</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">users</span>
<span class="k">WHERE</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">'Haxxor'</span><span class="p">;</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">users</span><span class="p">;</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="c1">-- ';</span><i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Strängen innehåller Haxx0r<strong>';</strong>. <code>'</code> gör att strängen avslutas, <code>;</code> avslutar frågan (som kommer köras, men resultatet används inte)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Drop table statement som stod efter <code>;</code> i strängen kommer köras</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Strängen avslutas med en kommentar, <code>';</code> är det som ursprungligen stod efter den interpolerade strängen.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>I SQLite3-biblioteket till Ruby vi använder körs som standard alltid enbart den första frågan i en query, dvs eventuella frågor som står efter ett <code>;</code> kommer ignoreras. Så exemplet ovan fungerar inte (men det finns en <code>db.execute_batch</code> som kör alla frågor med i queryn, och med <code>execute_batch</code> fungerar exemplet).</p>
</div>
<div class="paragraph">
<p>Men långt ifrån alla bibliotek och eller språk ignorerar eventuella extra frågor. I PHP fanns länge både funktionen <code>mysql_escape_string</code> och <code>mysql_<strong>real</strong>_escape_string</code> - den första var inte tillräckligt säker - och ingendera körde enbart den första frågan.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_requests_routing">Requests &amp; Routing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Webbapplikationer fungerar genom att en klient (webbläsare) kommunicerar med en server (i vårt fall Sinatra) med hjälp av protokollet HTTP.</p>
</div>
<div class="paragraph">
<p>I HTTP finns det två typer av meddelanden: HTTP <strong>Request</strong> och HTTP <strong>Response</strong></p>
</div>
<div class="paragraph">
<p>Förenklat sker kommunikationen enligt följande:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>En webbläsare skickar en HTTP request efter en viss <em>resurs</em> på servern.</p>
</li>
<li>
<p>Servern kollar sen om resursen finns.</p>
<div class="ulist">
<ul>
<li>
<p>Om resursen finns skickar servern en HTTP response med status 200 och vad nu resursen innerhåller för data (t.ex html).</p>
</li>
<li>
<p>Om resursen inte finns skickar servern en HTTP response med status 404 (och eventuellt html som visar ett fint felmeddelande).</p>
</li>
</ul>
</div>
</li>
<li>
<p>Klienten tolkar sen responsen (t.ex ritar upp HTML på skärmen)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Resurs</div>
<div class="paragraph">
<p>En <em>resurs</em> kan vara t.ex en bild, en css- eller javascript-fil, men det kan också vara en "sida" på en site: t.ex. https://www.fruit-o-matic.com<strong>/fruits</strong> eller https://fruit-o-matic.com<strong>/fruits/apples/3/</strong> där <code>/fruits</code> respektive <code>/fruits/apples/3</code> är resursen. En resurs är "R:et" i <code>URL</code>: Universal <strong>Resource</strong> Locator.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>En webbapplikation skickar <em>aldrig</em> information utan att den blivit ombedd. För att skicka information till en webbläsare måste webbläsaren först fråga efter informationen. Detta innebär att all kommunikation mellan en webbserver och en webbläsare alltid börjar med en <code>Request</code> från en klient (webbläsaren) och slutar med en <code>Response</code> från servern.</p>
</div>
<h3 id="_sekvensdiagram" class="discrete">Sekvensdiagram</h3>
<div class="paragraph">
<p>För att beskriva hur en HTTP Request/Response går till brukar man använda <a href="https://en.wikipedia.org/wiki/Sequence_diagram">sekvensdiagram</a></p>
</div>
<div class="paragraph">
<p>Sekvensdiagram beskriver hur olika <em>komponenter</em> (t.ex webbläsare och sinatra-server) skickar "meddelanden" till varandra. Meddelanden visas som text ovanför pilar som går från sändare till mottagare.</p>
</div>
<div class="imageblock sequence kroki-format-svg kroki">
<div class="content">
<img src="https://kroki.io/plantuml/svg/eNp1kM1OwzAQhO88xfYUkBqn5RhVOSBFRULQqj_iwmWbbBOLxDbORoW3x2kcaIq4-DDjb3ZnAQxalpk0qBj2DdkbGEkPVp_-qhvM3q-krVTIFp3apYRJ4skYlhpYw5sKSmbTxFF0tK3kUIc1Olpkuu6VJnCwpxzfzYjhcbdbw4Y-WmrYZUCwTHfg_5_NaC7mQoiO7Ygw8YvEUBDfBkP0nfO9E7rwn0_PyFkJWKBUboDVLVMDUgEaI-zhH2hDKicLTLWpkAn6GZF06qegETb0uJ_NphBMcp3xlyEoua5g0b3JoiTMk1GF39v19dPtevWyTc_9h85dIqyePDec7ZL1W66xoNFh9xcu5YO_93jvvurTFJrWneZA2LI8tpVvOfkGBRq3FA==" alt="Ett utförligt sekvensdiagram som beskriver en lyckad request efter resursen /fruits">
</div>
<div class="title">Ett utförligt sekvensdiagram som beskriver en lyckad request efter resursen /fruits</div>
</div>
<div class="paragraph">
<p>Sekvensdiagrammet ovan är onödigt detaljerat, i fortsättningen kommmer vi inte visa de komponenter vi ändå inte har kontroll över. Ett sekvensdiagram för motsvarande aktivitet ser då ut som nedan:</p>
</div>
<div class="imageblock sequence kroki-format-svg kroki">
<div class="content">
<img src="https://kroki.io/plantuml/svg/eNpTUChILCrJTM4sSMwrUXDOyUzNK-FSQBF0LCgAikCkdO3sgFwrBQV31xAF_bSi0sySYqAkUEwXJuWbWJKcoVCUX1qSiiYTlJqXklqkUJKaW5CTCJe1s4MYbaVgZGCgo1CUWpxfWpScCgDZczDl" alt="Ett mer kompakt sekvensdiagram som beskriver en lyckad request efter resursen /fruits">
</div>
<div class="title">Ett mer kompakt sekvensdiagram som beskriver en lyckad request efter resursen /fruits</div>
</div>
<div class="paragraph">
<p>Det finns två typer av <code>HTTP Requests</code> som en webbläsare kan skicka (det finns egentligen fler, men det är bara dessa två som är relevanta för kursen Webbserverprogrammering 1):</p>
</div>
<h5 id="_http_get_request" class="discrete">HTTP GET Request</h5>
<div class="paragraph">
<p>En <code>HTTP GET Request</code> ber om att få en specifik <code>resurs</code> på servern, men kan inte skicka med någon data till servern.</p>
</div>
<h5 id="_http_post_request" class="discrete">HTTP POST Request</h5>
<div class="paragraph">
<p>En <code>HTTP POST Request</code> skickar data (från t.ex. ett HTML-formulär) till servern.</p>
</div>
<h3 id="_routing" class="discrete">Routing</h3>
<div class="paragraph">
<p>Eftersom en webbserver aldrig gör något om den inte fått en <code>Request</code> är Requests centrala i en Sinatra-applikation.</p>
</div>
<div class="paragraph">
<p>I <code>app.rb</code> skrivar man sina <em>routes</em>, dvs regler som bestämmar vilka resurser som finns på servern och vad den ska göra om den får en HTTP Request (GET eller POST) till en specifik resurs.</p>
</div>
<div class="listingblock">
<div class="title">app.rb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">App</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span> <i class="conum" data-value="1"></i><b>(1)</b>

  <span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="n">erb</span> <span class="ss">:index</span>
  <span class="k">end</span>

  <span class="n">get</span> <span class="s1">'/fruits'</span> <span class="k">do</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="n">erb</span> <span class="ss">:'fruits/index'</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Talar om att filen innehåller en Sinatra-applikation.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Konfigurerar en <code>Route</code> för resursen "/"</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Konfigurerar en <code>Route</code> för resursen "/fruits"</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>När en Sinatra-applikation tar emot en request från en klient söker den efter en <em>route</em> som matchar requestens <em>verb</em> (<code>GET</code> eller <code>POST</code>) och dess resurs (t.ex <code>/fruits</code>). Koden i första routen som matchar kommer att köras, och resultatet läggs i ett <code>HTTP Response</code> och skickas tillbaks till klienten som skickat Requesten.</p>
</div>
<div class="paragraph">
<p>Man kan låtsas att routes i en Sinatra-app fungerar som en lång if-elsif-else-sats, enligt nedan:</p>
</div>
<div class="listingblock">
<div class="title">pseudokod som beskriver en <strong>tankemodell</strong> för hur routing fungerar</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="k">if</span> <span class="n">verb</span> <span class="o">==</span> <span class="s2">"GET"</span> <span class="o">&amp;&amp;</span> <span class="n">resource</span> <span class="o">==</span> <span class="s2">"/"</span>
  <span class="k">return</span> <span class="n">erb</span><span class="p">(</span><span class="ss">:index</span><span class="p">)</span>
<span class="k">elsif</span> <span class="n">verb</span> <span class="o">==</span> <span class="s2">"GET"</span> <span class="o">&amp;&amp;</span> <span class="n">resource</span> <span class="o">==</span> <span class="s1">'/fruits'</span>
  <span class="k">return</span> <span class="n">erb</span><span class="p">(</span><span class="ss">:'fruits/index'</span><span class="p">)</span>
<span class="k">elsif</span> <span class="no">File</span><span class="p">.</span><span class="nf">exist?</span><span class="p">(</span><span class="s2">"./public</span><span class="si">#{</span><span class="n">resource</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
  <span class="k">return</span> <span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s2">"./public</span><span class="si">#{</span><span class="n">resource</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="k">else</span>
  <span class="k">return</span> <span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="s2">"Not Found"</span><span class="p">)</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Det är inte så det är implementerat <em>egentligen</em>, men tankemodellen fungerar när man ska bestämma vilka routes man ska ha och i vilken ordning i de behöver finnas i.</p>
</div>
<div class="paragraph">
<p>Det finns två typer av routes:</p>
</div>
<h4 id="_statiska_routes" class="discrete">Statiska Routes</h4>
<div class="paragraph">
<p>En statisk route innehåller inga dynamiska bitar, det vill säga, den request som kommer måste matcha <strong>exakt</strong> mot routen som den är skriven i Sinatra.</p>
</div>
<div class="listingblock">
<div class="title">Tre statiska routes</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
</pre></td><td class="code"><pre><span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="o">...</span> <span class="c1">#Lämplig kod</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s1">'/weather'</span> <span class="k">do</span> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="o">...</span> <span class="c1">#Lämplig kod</span>
<span class="k">end</span>

<span class="n">post</span> <span class="s1">'/weather'</span> <span class="k">do</span> <i class="conum" data-value="3"></i><b>(3)</b>
  <span class="o">...</span> <span class="c1">#Lämplig kod</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Matchar <code>HTTP <strong>GET</strong> Requests</code> till <code>/</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Matchar <code>HTTP <strong>GET</strong> Requests</code> till <code>/weather</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Matchar <code>HTTP <strong>POST</strong> Requests</code> till <code>/weather</code></td>
</tr>
</table>
</div>
<h4 id="_dynamiska_routes" class="discrete">Dynamiska Routes</h4>
<div class="paragraph">
<p>En dynamisk route är en route där <em>delar</em> av routen kan skilja från den route som är skriven.
En dynamisk route skapas genom att man ersätter den bit av routen som ska vara dynamisk med ett kolon (<code>:</code>) följt av ett beskrivande ord.</p>
</div>
<div class="listingblock">
<div class="title">En dynamisk route</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span class="n">get</span> <span class="s1">'/weather/:city'</span> <span class="k">do</span> <span class="o">|</span><span class="n">city</span><span class="o">|</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="o">...</span> <span class="c1">#Lämplig kod</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Matchar <code>HTTP <strong>GET</strong> Requests</code> till <code>/weather/<strong>VADSOMHELST</strong>/`</code>, t.ex <code>/weather/goteborg</code> eller <code>/weather/oslo</code> eller <code>/weather/3</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Eftersom man antagligen vill veta vad det var för värde som låg på den dynamiska biten i requesten behöver man fånga upp den.</p>
</div>
<div class="listingblock">
<div class="title">En dynamisk route som faktiskt fångar upp den dynamiska <strong>parametern</strong></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span class="n">get</span> <span class="s1">'/weather/:city'</span> <span class="k">do</span> <span class="o">|</span><span class="n">city</span><span class="o">|</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="o">...</span> <span class="c1">#Lämplig kod</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Variabeln <code>city</code> innehåller nu vad som fanns på motsvarande ställe i requesten, text "goteborg", "oslo" eller "3".</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Siffror i dynamiska routes</div>
<div class="paragraph">
<p>Det som lagras i variabeln som fångar upp en parameter från en dynamisk route kommer <strong>alltid</strong> vara en sträng, även om det innehåller siffror.
Om applikationen förnväntar sig ett tal (integer) behöver man omvandla siffran till en integer med <code>.to_i</code></p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">En dynamisk route med två <strong>parametrar</strong></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span class="n">get</span> <span class="s1">'/weather/:city/temperature/:date'</span> <span class="k">do</span> <span class="o">|</span><span class="n">location</span><span class="p">,</span> <span class="n">date</span><span class="o">|</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="o">...</span> <span class="c1">#Lämplig kod</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>När man har flera <em>parametrar</em> i en dynamisk route mappas parametrar till variabler i den ordning de kommer. Om requesten är <code>GET /weather/<strong>goteborg</strong>/temperature/<strong>2023-09-23</strong></code> kommer <code>location</code> innehålla <code>'goteborg'</code> och <code>date</code> innehålla <code>'2023-09-23'</code>.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Namngivning av parametrar och variabler i dynamiska routes</div>
<div class="paragraph">
<p>Parametrar (<code>:city</code>) och variabler (<code>location</code>) <em>behöver</em> inte heta likadant, men det blir ofta förvirrande om de inte gör det.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_formulär_och_get_post_redirect_cykeln">Formulär och GET-POST-Redirect-Cykeln</h3>
<div class="paragraph">
<p>Formulär skickar data via <code>POST</code>-requests. Men en <code>POST</code>-request ska inte användas för att <em>visa</em> data - det är vad <code>GET</code>-requests är till för.</p>
</div>
<div class="paragraph">
<p>För att visa resursen som skapats när en användare skickat in data via ett formulär måste man därför säga till användarens webbläsare vart den ska ta vägen (dvs göra en <code>GET</code>-request till) efter servern behandlat datan.</p>
</div>
<div class="paragraph">
<p>Detta görs genom att servern, efter den behandlat datan från formuläret, skickar tillbaks en <code>Response</code> som talar om vart webbläsaren ska skicka en <code>GET</code>-request. Webbläsaren skickar sen automagiskt en <code>GET</code>-request dit servern specificerat.</p>
</div>
<div class="imageblock sequence kroki-format-svg kroki">
<div class="content">
<img src="https://kroki.io/plantuml/svg/eNqNUctuwjAQvPcrRlwIEoiI3hBy1fepalXSDzDOplh1bMveiN-vSVIKTYW4eeehnfECXgbWSntpGfdGk-UrnIC33ieko2ZCpHEJPD8WmFeh0RwTmbDZD_UiWW0RXMP0h3knW1IAU-2NZEK207xF5UI96ZVCdGuWWOT5FIGia4JKSuUsS221_Tzo-0BHnidtTERa3GoGmd9e1wXGfegxsnWzqdOrFeMQBaVkObm400ekXxuymCqCXTttZKSbYbPrfLFvVupAiqcY9YHmq5Uu4SpY2qGFhBgNOhx9-3-Gi2MX0nx1nR_u9mlODnP-GN8EWbMb" alt="GET-POST-Redirect-cykeln i ett Sekvensdiagram">
</div>
<div class="title">GET-POST-Redirect-cykeln i ett Sekvensdiagram</div>
</div>
<div class="imageblock flowchart kroki-format-svg kroki">
<div class="content">
<img src="https://kroki.io/plantuml/svg/eNpdjlEOAiEMRP89Rc-xfnoET4AwRBKgawf0-rKRhI1_Tfs687ZbTqhNDK8ONo6B2s3jetnusDdsbGqArYt8UntKVCuDme8x5UzR3sTVIOyPkkbWZGbObupBghJccxJNyx_B0XT0hGTwhxN3rcSqOVn-GIQl_AWzvUrY" alt="GET-POST-Redirect-cykeln som ett flödesschema">
</div>
<div class="title">GET-POST-Redirect-cykeln som ett flödesschema</div>
</div>
</div>
<div class="sect2">
<h3 id="_formulärbehandlande_routes_i_sinatra">Formulärbehandlande routes i Sinatra</h3>
<div class="paragraph">
<p>Givet följande formulär som skickas in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="html"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">'/fruits'</span> <span class="na">method=</span><span class="s">"POST"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">'text'</span> <span class="na">name=</span><span class="s">"fruit"</span> <span class="na">placeholder=</span><span class="s">"Fruit name"</span><span class="nt">&gt;&lt;/input&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">'number'</span> <span class="na">name=</span><span class="s">"rating"</span><span class="nt">&gt;&lt;/input&gt;</span>
  <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">'submit'</span><span class="nt">&gt;</span>Create new fruit rating<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>För att ta emot datan från formuläret i Sinatra behöver vi skapa en route som matchar formulärets <code>method</code> och <code>action</code> - i det här fallet <code>POST</code> och <code>/fruits</code>.</p>
</div>
<div class="listingblock">
<div class="title">Exempel på en route som behandlar data från formulär</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="n">post</span> <span class="s1">'/fruits'</span> <span class="k">do</span>  <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="nb">name</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">'fruit'</span><span class="p">]</span> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="n">rating</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">'rating'</span><span class="p">].</span><span class="nf">to_i</span> <i class="conum" data-value="3"></i><b>(3)</b>
  <span class="n">query</span> <span class="o">=</span> <span class="s1">'INSERT INTO fruits (name, rating) VALUES (?,?) RETURNING id'</span>
  <span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="nb">name</span><span class="p">,</span> <span class="n">rating</span><span class="p">).</span><span class="nf">first</span> <i class="conum" data-value="4"></i><b>(4)</b>
  <span class="n">redirect</span> <span class="s2">"/fruits/</span><span class="si">#{</span><span class="n">result</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <i class="conum" data-value="5"></i><b>(5)</b>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Den route som datan från formuläret skickas till. Observera <code>post</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Params innehåller <code>'fruit'</code> eftersom formuläret har ett input-element med <code>name="fruit"</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>All data i params är alltid strängar, om du vill ha något annat behöver man göra en typomvandling (t.ex <code>to_i</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Datan från formuläret behandlas på lämpligt sätt (exemplet förutsätter t.ex. att det finns en fruits-tabell)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Servern skickar ett redirect-response. Klienten kommer automagiskt skicka en ny förfrågan efter resursen</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Exempel på en route man kan redirectas till (eller surfa direkt till)</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span class="n">get</span> <span class="s1">'/fruits/:id'</span> <span class="k">do</span> <span class="o">|</span><span class="n">fruit_id</span><span class="o">|</span>  <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="vi">@fruit</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="s1">'SELECT * FROM fruits WHERE id = ?'</span><span class="p">,</span> <span class="n">fruit_id</span><span class="p">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="n">erb</span> <span class="ss">:'fruits/show'</span> <i class="conum" data-value="3"></i><b>(3)</b>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>En dynamisk route, som "råkar" matcha routen som redirecten ovan går till.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Gör lämplig behandling av parametrarna i routen</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Rendera lämplig mall.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_routes_för_crud">Routes för CRUD</h3>
<div class="paragraph">
<p>De allra, allra flesta webbapplikationer är så kallade CRUD-applikationer, det vill säga man kan skapa (<strong>C</strong>reate), visa (<strong>R</strong>ead), ändra (<strong>U</strong>pdate), och ta bort (<strong>D</strong>elete) olika <em>resurser</em>.</p>
</div>
<div class="paragraph">
<p>Eftersom dessa operationer (CRUD) är så vanliga finns det en standard för hur man ska jobba med dem. Det finns 7 olika <em>actions</em> och varje <em>action</em> och <em>resurs</em> motsvarar en <em>route</em> i <code>app.rb</code></p>
</div>
<div class="paragraph">
<p>I exemplet nedan utgår vi från en app som är ett digitalt klotterplank, där resursen är <code>message</code>.</p>
</div>
<div class="paragraph">
<p>Ett message består av ett <code>id</code> och <code>content</code> (textinnehållet i meddelandet).</p>
</div>
<div class="paragraph">
<p>I appen kan vem som helst kan skriva (<strong>C</strong>reate) ett meddelande och meddelandena kan visas (<strong>R</strong>ead), ändras (<strong>U</strong>pdate) och tas bort (<strong>D</strong>elete) av vem som helst. Följande actions och routes finns för <code>message</code>, men de <code>routes</code> och <code>actions</code> som visas gäller för alla sorters resurser.</p>
</div>
<div class="sect3">
<h4 id="_action_index_route_messages_method_get">Action: <code>index</code> route : <code>/messages</code> method: <code>get</code></h4>
<div class="paragraph">
<p><code>index</code> visar <em>en listning</em> av alla förekomster av den aktuella resursen. Eventuellt kan listan vara filtrerad (t.ex skulle enbart meddelanden som tillhör den aktuella användaren kunna visas, om applikationen hade haft stöd för användare och inloggning).</p>
</div>
<div class="listingblock">
<div class="title">messages#index route i app.rb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="o">...</span>
  <span class="c1"># messages#index </span><i class="conum" data-value="1"></i><b>(1)</b>
  <span class="n">get</span> <span class="s1">'/messages'</span> <span class="k">do</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="vi">@messages</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="s1">'SELECT * FROM messages'</span><span class="p">)</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="n">erb</span> <span class="ss">:'messages/index'</span> <i class="conum" data-value="4"></i><b>(4)</b>
  <span class="k">end</span>
<span class="o">...</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>En kommentar som berättar vilken resurs och action routen motsvarar</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Routen för <code>index</code> är <code>/&lt;resursens namn i plural&gt;</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Eftersom index ska visa en listning, hämtar vi alla messages från databasen</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>För att strukturera upp våra views skapar vi en mapp per resurs, och döper vy-filen till <code>&lt;action&gt;.erb</code> och sparar i mappen för resursen.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">views/messages/index.erb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="erb"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span class="cp">&lt;%</span> <span class="vi">@messages</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">message</span><span class="o">|</span> <span class="cp">%&gt;</span>
	<span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="n">message</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_action_show_route_messagesid_method_get">Action: <code>show</code> route: <code>/messages/:id</code> method: <code>get</code></h4>
<div class="paragraph">
<p><code>show</code> visar <strong>en</strong> specifik instans av den aktuella resursen, identifierad av dess <code>id</code>. Detta förutsätter att alla instanser av den aktuella resursen har ett unikt id.</p>
</div>
<div class="listingblock">
<div class="title">messages#show route i app.rb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="o">...</span>
  <span class="c1"># messages#show</span>
  <span class="n">get</span> <span class="s1">'/messages/:id'</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="vi">@message</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="s1">'SELECT * FROM messages WHERE id = ?'</span><span class="p">,</span> <span class="nb">id</span><span class="p">).</span><span class="nf">first</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="n">erb</span> <span class="ss">:'messages/show'</span>
  <span class="k">end</span>
<span class="o">...</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Routen för <code>show</code> är <code>/&lt;resursens namn i plural&gt;/&lt;resursens id&gt;</code>. Plocka ut <code>id</code>-parametern med <code>|id|</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Eftersom vi alltid får en array från <code>db.execute</code> och vi bara vill ha <em>en</em> instans i värdet tar vi det första (och enda) elementet från arrayen.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">views/messages/show.erb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="erb"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre><span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@message</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_action_new_route_messagesnew_method_get">Action: <code>new</code> route: <code>/messages/new</code> method: <code>get</code></h4>
<div class="paragraph">
<p><code>new</code> visar ett formulär för att skapa en ny instans av den aktuella resursen. Eventuellt kan man istället/även visa formuläret på <code>index</code> eller någon annanstans.</p>
</div>
<div class="listingblock">
<div class="title">messages#new route i app.rb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="o">...</span>
  <span class="c1"># messages#new</span>
  <span class="n">get</span> <span class="s1">'/messages/new'</span> <span class="k">do</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="n">erb</span> <span class="ss">:'messages/new'</span>
  <span class="k">end</span>
<span class="o">...</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Routen för <code>new</code> är <code>/&lt;resursens namn i plural&gt;/new</code>.</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>new</code>-routen måste ligga <strong>innan</strong> show-routen i <code>app.rb</code>.</p>
</div>
<div class="paragraph">
<p>Varför då?</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">views/messages/new.erb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="erb"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">'/messages/'</span> <span class="na">method=</span><span class="s">'post'</span><span class="nt">&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">'text'</span> <span class="na">name=</span><span class="s">'content'</span><span class="nt">&gt;&lt;/input&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">'submit'</span><span class="nt">&gt;</span>Send<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>action</code> och <code>method</code> för <code>new</code>-formuläret motsvarar <code>create</code>-routen (se nedan)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>name</code> anger namnet på parametern som skickas till <code>create</code>-routen (se nedan)</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_action_create_route_messages_method_post">Action: <code>create</code> route: <code>/messages</code> method: <code>post</code></h4>
<div class="paragraph">
<p><code>create</code> är routen new-formuläret postar datan till. Behöver sedan redirecta användaren till lämplig adress.</p>
</div>
<div class="listingblock">
<div class="title">messages#create route i app.rb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="o">...</span>
  <span class="c1"># messages#create</span>
  <span class="n">post</span> <span class="s1">'/messages/'</span> <span class="k">do</span> <i class="conum" data-value="1"></i><b>(1)</b>
  	<span class="n">message</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="n">query</span> <span class="o">=</span> <span class="s1">'INSERT INTO messages (message) VALUES (?) RETURNING *'</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">message</span><span class="p">).</span><span class="nf">first</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="n">redirect</span> <span class="s2">"/messages/</span><span class="si">#{</span><span class="n">result</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span> <i class="conum" data-value="4"></i><b>(4)</b>
  <span class="k">end</span>
<span class="o">...</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Routen för <code>create</code> är <code>/&lt;resursens namn i plural&gt;</code> med <code>post</code> som method.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Hämta ut datan som skickats från <code>new</code>-formuläret</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Spara i databasen, och lagra resultatet</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Gör en <code>redirect</code> till <code>show</code> för den nya instansen (eller gör en <code>redirect</code> nån annan route)</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_action_edit_route_messagesidedit_method_get">Action: <code>edit</code> route: <code>/messages/:id/edit</code> method: <code>get</code></h4>
<div class="paragraph">
<p><code>edit</code> visar ett formulär för att uppdatera en befintlig instans av den aktuella resursen. Eventuellt kan man istället/även visa formuläret på <code>show</code> eller någon annanstans.</p>
</div>
<div class="listingblock">
<div class="title">messages#edit route i app.rb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="o">...</span>
  <span class="c1"># messages#new</span>
  <span class="n">get</span> <span class="s1">'/messages/:id/edit'</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="vi">@message</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="s1">'SELECT * FROM messages WHERE id = ?'</span><span class="p">,</span> <span class="nb">id</span><span class="p">.</span><span class="nf">to_i</span><span class="p">).</span><span class="nf">first</span>
    <span class="n">erb</span> <span class="ss">:'messages/edit'</span>
  <span class="k">end</span>
<span class="o">...</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Routen för <code>edit</code> är <code>/&lt;resursens namn i plural&gt;/&lt;resursens id&gt;/edit</code>.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">views/messages/edit.erb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="erb"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">'/messages/</span><span class="cp">&lt;%=</span><span class="vi">@message</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span><span class="cp">%&gt;</span><span class="s">/update'</span> <span class="na">method=</span><span class="s">'post'</span><span class="nt">&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">'text'</span> <span class="na">name=</span><span class="s">'content'</span> <span class="na">value=</span><span class="s">'</span><span class="cp">&lt;%=</span> <span class="vi">@message</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span><span class="cp">%&gt;</span><span class="s">'</span><span class="nt">&gt;&lt;/input&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">'submit'</span><span class="nt">&gt;</span>Send<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>action</code> och <code>method</code> för <code>edit</code>-formuläret motsvarar <code>update</code>-routen (se nedan)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>value</code> "förifyller" input-elementet med datan från backend).</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_action_update_route_messagesidupdate_method_post">Action: <code>update</code> route: <code>/messages/:id/update</code> method: <code>post</code></h4>
<div class="paragraph">
<p><code>update</code> är routen edit-formuläret postar datan till. Behöver sedan redirecta användaren till lämplig adress.</p>
</div>
<div class="listingblock">
<div class="title">messages#edit route i app.rb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span class="o">...</span>
  <span class="c1"># messages#update</span>
  <span class="n">post</span> <span class="s1">'/messages/:id/update'</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="n">message</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span>
    <span class="n">db</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="s1">'UPDATE messages SET content = ? WHERE id = ?'</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
    <span class="n">redirect</span> <span class="s2">"/messages/</span><span class="si">#{</span><span class="nb">id</span><span class="si">}</span><span class="s2">"</span> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="k">end</span>
<span class="o">...</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Routen för <code>update</code> är <code>/&lt;resursens namn i plural&gt;/&lt;resursens id&gt;/update</code> med <code>post</code> som method.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Redirect till lämpligt ställe</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_action_delete_route_messagesiddelete_method_post">Action: <code>delete</code> route: `/messages/:id/delete method: `post</h4>
<div class="paragraph">
<p><code>delete</code> är routen delete-formuläret postar datan till. Delete-formuläret är antagligen bara ett minimalt formulär runt en knapp och ligger antagligen inte i en egen vy-fil (men kanske i <code>index.erb</code> eller <code>show.erb</code>):</p>
</div>
<div class="listingblock">
<div class="title">views/messages/index eller views/messages/show eller annat lämpligt view-fil</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="erb"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">'/messages/</span><span class="cp">&lt;%=</span> <span class="vi">@message</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span> <span class="cp">%&gt;</span><span class="s">/delete'</span> <span class="na">method=</span><span class="s">'post'</span><span class="nt">&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>DELETE<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>action</code> och <code>method</code> för <code>delete</code>-formuläret motsvarar <code>delete</code>-routen (se nedan)</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">messages#delete route i app.rb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="o">...</span>
  <span class="c1"># messages#delete</span>
  <span class="n">post</span> <span class="s1">'/messages/:id/delete'</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="n">db</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="s1">'DELETE FROM messages WHERE id = ?'</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
		<span class="n">redirect</span> <span class="s2">"/messages/"</span>
  <span class="k">end</span>
<span class="o">...</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Routen för <code>delete</code> är <code>/&lt;resursens namn i plural&gt;/&lt;resursens id&gt;/delete</code> med <code>post</code> som method.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_registrering_inloggning">Registrering &amp; Inloggning</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Läs först <a href="#_kakor_kryptering_och_sessioner">Kakor, kryptering och sessioner</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>För att använda säker inloggning behöver man kunna hasha användares lösenord. Standardlösningen för Sinatra är att använda <code>bcrypt</code>:</p>
</div>
<div class="listingblock">
<div class="title">Gemfile</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="n">source</span> <span class="s1">'https://rubygems.org'</span>

<span class="n">gem</span> <span class="s1">'thin'</span>
<span class="n">gem</span> <span class="s1">'sinatra'</span>
<span class="n">gem</span> <span class="s1">'rerun'</span>
<span class="n">gem</span> <span class="s1">'sqlite3'</span>
<span class="hll"><span class="n">gem</span> <span class="s1">'bcrypt'</span>
</span></pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Lägg till <code>bcrypt</code> i din Gemfile och kör <code>bundle install</code>.</p>
</div>
<div class="paragraph">
<p>Skapa en tabell för användare med åtminstone användarnamn och lösenord.</p>
</div>
<div class="sect3">
<h4 id="_registrering">Registrering</h4>
<div class="paragraph">
<p>Skapa ett formulär för registrering av användare.</p>
</div>
<div class="paragraph">
<p>Skapa en route för registreringsformuläret</p>
</div>
<div class="paragraph">
<p>I routen, använd <code>bcrypt</code> för att hasha lösenordet innan det lagras i databasen:</p>
</div>
<div class="listingblock">
<div class="title">I registreringsrouten</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre><span class="o">...</span>
  <span class="n">cleartext_password</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">'password'</span><span class="p">]</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="n">hashed_password</span> <span class="o">=</span> <span class="no">BCrypt</span><span class="o">::</span><span class="no">Password</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">cleartext_password</span><span class="p">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="c1">#spara användare och hashed_password till databasen</span>
<span class="o">...</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Hämta det inskrivna lösenordet från params</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Hasha det inskrivna lösenordet.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Bcrypt kommer automagiskt salta lösenordet och lägga till salten i den hashade strängen.</p>
</div>
</div>
<div class="sect3">
<h4 id="_inloggning">Inloggning</h4>
<div class="paragraph">
<p>Skapa ett formulär för inlogging</p>
</div>
<div class="paragraph">
<p>Skapa en route för inloggningsformuläret</p>
</div>
<div class="paragraph">
<p>I routen, använd <code>bcrypt</code> för att jämföra det inmatade lösenordet med det sparade saltade och hashade lösenordet:</p>
</div>
<div class="listingblock">
<div class="title">I inloggningsrouten</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
</pre></td><td class="code"><pre><span class="o">...</span>
  <span class="n">username</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">'username'</span><span class="p">]</span>
  <span class="n">cleartext_password</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">'password'</span><span class="p">]</span> <i class="conum" data-value="1"></i><b>(1)</b>

  <span class="c1">#hämta användare och lösenord från databasen med hjälp av det inmatade användarnamnet.</span>
  <span class="n">user</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="s1">'SELECT * FROM users WHERE username = ?'</span><span class="p">,</span> <span class="n">username</span><span class="p">).</span><span class="nf">first</span>
<span class="hll">
</span>  <span class="c1">#omvandla den lagrade saltade hashade lösenordssträngen till en riktig bcrypt-hash</span>
  <span class="n">password_from_db</span> <span class="o">=</span> <span class="no">BCrypt</span><span class="o">::</span><span class="no">Password</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">user</span><span class="p">[</span><span class="s1">'password'</span><span class="p">])</span>

  <span class="c1">#jämför lösenordet från databasen med det inmatade lösenordet</span>
  <span class="k">if</span> <span class="n">password_from_db</span> <span class="o">==</span> <span class="n">clertext_password</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="n">session</span><span class="p">[</span><span class="ss">:user_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="o">...</span> <i class="conum" data-value="3"></i><b>(3)</b>
  <span class="k">else</span>
    <span class="o">...</span> <i class="conum" data-value="4"></i><b>(4)</b>
  <span class="k">end</span>
<span class="o">...</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Bcrypt kommer automagiskt extrahera salten från det lagrade databaset, salta &amp; hasha klartextlösenordet och jämföra resultatet</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Lösenordet stämde, lagra i sessionskakan.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Övrig kod som behöver ske.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Lösenordet stämde inte, gör något annat.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_autorisering_kontroll_av_användare_och_rättigheter">Autorisering (kontroll av användare och rättigheter)</h4>
<div class="listingblock">
<div class="title">I <strong>alla</strong> routes där du behöver veta om någon/vem är inloggad:</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span class="o">...</span>
  <span class="n">user_id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="ss">:user_id</span><span class="p">]</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="c1"># Kod för att kontrollera om användaren finns, och/eller har rättighet att se det som ska visas</span>
<span class="o">...</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Hämta användaren från sessionen</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_utloggning">Utloggning</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Skapa ett formulär för utloggning (innehåller antagligen enbart en knapp).</p>
</li>
<li>
<p>Skapa en route för utloggningsformuläret</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title">I utloggningsrouten</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span class="o">...</span>
  <span class="n">session</span><span class="p">.</span><span class="nf">destroy</span>
<span class="o">...</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kakor_kryptering_och_sessioner">Kakor, kryptering och sessioner.</h2>
<div class="sectionbody">
<div class="paragraph">
<p>För att bygga säkra webbapplikationer behöver man hålla koll på 5 begrepp: <strong>kakor</strong>, <strong>sessioner</strong>, <strong>kryptering</strong>, <strong>hashning</strong> och <strong>saltning</strong></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title"><strong>HTTP är Stateless</strong>.</div>
<div class="paragraph">
<p>HTTP (och därmed webbservrar som Sinatra) är <strong>stateless</strong>, dvs de har inget "minne" av tidigare requests, dvs varje requests behandlas i separation från alla andra requests. Detta innebär att en webbläsare inte har något sätt att veta om requests kommer från samma webbläsare.</p>
</div>
<div class="paragraph">
<p>Man har valt att göra HTTP stateless eftersom det skulle ta för mycket resurser (minne) på servern att "komma ihåg" alla klienter som är uppkopplade mot servern - en webbserver kan ju ha miljontals klienter som skickar requests till den.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_kakor">Kakor</h3>
<div class="paragraph">
<p>För att kunna lagra state, trots att HTTP är stateless har man hittat på kakor ("cookies").</p>
</div>
<div class="paragraph">
<p>En kaka är data från servern som lagras i webbläsaren. Kakor skapas på servern och skickas till webbläsaren i ett <code>HTTP-Response</code>.</p>
</div>
<div class="paragraph">
<p>Kakor tillhör alltid en <strong>domän</strong>, t.ex <code><a href="http://fruitomatic.com" class="bare">fruitomatic.com</a></code>, eller <code><a href="http://localhost:9292" class="bare">localhost:9292</a></code>. Om webbläsaren har en kaka som tillhör den domän som webbläsaren skickar en <code>HTTP-Request</code> till kommer kakan <em>alltid</em> att skickas med, för varje request till den domänen.</p>
</div>
<div class="paragraph">
<p>På servern kan man sen kolla på kakan, och baserat på vad den innehåller, välja att hantera requesten olika.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title"><strong>Kakor tar plats</strong>.</div>
<div class="paragraph">
<p>Eftersom kakor skickas med <em>varje</em> request är det viktigt att inte lagra onödig data i kakan - dels blir det segare att skicka requesten, dels blir det mer data att tolka på servern. Oftast kommer man enbart lagra användarens id i kakan.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title"><strong>Kakor är okrypterade</strong>.</div>
<div class="paragraph">
<p>Innehållet i en kaka är i klartext ("okrypterad"). Detta innebär att användaren kan läsa all information som står i kakan.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/cookies_encryption_and_sessions/images/cleartext_cookie.png" alt="En kaka med data i klartext">
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title"><strong>Kakor kan ändras av användaren</strong>.</div>
<div class="paragraph">
<p>Användaren kan i webbläsaren ändra allt innehåll i en kaka. Om man t.ex. lagrar användarens id i kakan för att hålla koll på vilken användare som är inloggad kan användaren lätt ändra till en annan användares id och då kommer servern anta att kommande requests kommer från den användaren istället.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/cookies_encryption_and_sessions/images/edit_cookie.png" alt="En kakas värden kan ändras i webbläsaren">
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_kryptering">Kryptering</h3>
<div class="paragraph">
<p>För att kunna lagra information i kakor, och samtidigt förhindra att användaren kan ändra (eller ens läsa) innehållet i kakan behöver vi kryptera innehållet i kakan.</p>
</div>
<div class="paragraph">
<p>Förenklat kan man säga att vi tar det vi vill lagra i kakan, t.ex strängen "favourite_fruit &#8658; "apple" och krypterar den till en annan sträng, t.ex "fofavovouroritote_fofroruitot &#8658; apoppoplole".</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title"><strong>Krypterade kakor är fortfarande läsbara</strong>.</div>
<div class="paragraph">
<p>Om vi krypterar innehållet i kakan, kommer användaren fortfarande att kunna läsa innehållet i kakan, men hen kommer inte förstå vad den innehåller.</p>
</div>
<div class="paragraph">
<p>Användaren kan också fortfarande ändra kakans värde, men sannolikheten att hen skulle kunna lyckas ändra den krypterade strängen, till en annan <em>korrekt krypterad</em> sträng, är så liten att man helt kan bortse från den (förutsatt att vi valt en tillräckligt säker krypteringsalgoritm).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_sessioner">Sessioner</h3>
<div class="paragraph">
<p>För att hålla koll på <em>state</em> för en besökare på en webapplikation använder man begreppet <strong>session</strong>.</p>
</div>
<div class="paragraph">
<p>När en webbläsare första gången skickar en request till servern upprättar man en <strong>session</strong> för den webbläsaren (användaren).
I sessionen kan man sen lagra information om användaren.</p>
</div>
<div class="paragraph">
<p>I Sinatra använder man så kallade sessionskakor för att hålla koll på sessioner. En sessionskaka är en krypterad kaka som ska användas för att lagra information om användaren.</p>
</div>
<div class="listingblock">
<div class="title">Konfigurera Sinatra att använda sessionskakor</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">App</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>

<span class="hll">    <span class="n">enable</span> <span class="ss">:sessions</span>
</span>
    <span class="o">...</span>

<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Om man använder <code>enable :sessions</code> i Sinatra kommer varje besökare automagiskt få en krypterad kaka vid första besöket.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/cookies_encryption_and_sessions/images/session_cookie.png" alt="En kaka med data i klartext">
</div>
<div class="title">En sessionskaka från Sinatra</div>
</div>
<div class="paragraph">
<p>För att läsa av och modifiera innehållet i en sessionskaka använder man variabeln <code>session</code>:</p>
</div>
<div class="listingblock">
<div class="title">Använda sessionskakor i Sinatra</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">App</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>

  <span class="n">enable</span> <span class="ss">:sessions</span>

  <span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span>
    <span class="n">session</span><span class="p">[</span><span class="ss">:user_id</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="k">end</span>

  <span class="n">get</span> <span class="s1">'/home'</span> <span class="k">do</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="ss">:user_id</span><span class="p">]</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="o">...</span> <i class="conum" data-value="3"></i><b>(3)</b>
  <span class="k">end</span>

<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Lagra data i sessionskakan.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Läs data från sessionskakan.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Använd datan från sessionskakan, t.ex för att hämta en användare från databasen.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Sinatra avkrypterar och krypterar automagiskt sessionskakorna. Observera återigen att kakan kommer skickas med från webbläsaren för varje request, så det är viktigt att lagra så lite information som möjligt i kakan.</p>
</div>
</div>
<div class="sect2">
<h3 id="_hashning">Hashning</h3>
<div class="paragraph">
<p>Hashning är ett kryptografiskt begrepp som innebär att man kan kryptera något, som sen inte går att avkryptera. Man kan se det som en envägskryptering. Skillnaden mellan kryptering och hashning är alltså att kryptering går att avkryptera (om man har rätt nyckel).</p>
</div>
<div class="paragraph">
<p>Sessionskakan måste vara krypterad så vi kan läsa av den, men om vi ska lagra användares lösenord ska de hashas - så vi inte kan läsa dem.</p>
</div>
<div class="paragraph">
<p>Men, kanske någon tänker nu, om vi inte kan läsa av lösenorden, hur ska vi då kunna kolla om någon anger rätt lösenord för att logga in? Svaret är att vi provar att hasha det de skrev in, och kontrollerar om resultatet av det hashade inskrivna lösenordet matchar det hashade lösenordet vi lagrat i databasen.</p>
</div>
</div>
<div class="sect2">
<h3 id="_salting">Salting</h3>
<div class="paragraph">
<p>Eftersom samma input till en hashningsalgoritm alltid ger samma input räcker inte hashning av lösenorden. (t.ex skulle input "hemligt" till en tänkt hashningsalgoritm <em>alltid</em> ge "1a2806367d23c7884dfde273882ad6a9" som output).</p>
</div>
<div class="paragraph">
<p>För att kunna knäcka lösenord skulle man lätt skriva ett program som hashar alla vanliga lösenord, och sen skulle man bakvägen kunna se vilka lösenord som lagrats.</p>
</div>
<div class="paragraph">
<p>För att öka säkerheten använder man en så kallad <strong>password salt</strong>. En salt är en slumpad sträng som man lägger till på klartextlösenordet <em>innan</em> det hashas.</p>
</div>
<div class="paragraph">
<p>Exempelvis skulle vi kunna ta "hemligt", lägga till den slumpade strängen "abc123", få "hemligtabc123" och sen hasha den sammanslagna strängen och få resultatet "ced772b8bee4a1b208efb5bed6f86651". Om vi alltid slumpar olika salt kommer lösenorden, även om de är likadana, få olika hashingsresultat.</p>
</div>
<div class="paragraph">
<p>Nu har vi ett nytt problem: för att kunna kolla om ett inmatat lösenord matchar en lagrad saltad hash måste vi ju veta vad salten var. Lösningen är att lägga till salten i i hashen, t.ex "ced772b8bee4a1b208efb5bed6f86651+abc123". Vi kan då plocka ut salten ur hashen, lägga till den till det inmatade lösenordet, och sen se om den genererade hashen matchar den lagrade hashen utan den pålagda saltningen.</p>
</div>
<div class="imageblock flowchart kroki-format-svg kroki">
<div class="content">
<img src="https://kroki.io/plantuml/svg/eNqFj00OgjAQhfeeYuJKw0ZQkOgFXLjTpZspHUpjWwjUxAPhFbwAF7NF4k80up335nvvrfYIpEsLZC2o7tqQKWsOEo4Ka0tnCwcDk3FBWklhx9P1aLVTJ125LwMNqkFHloXRvJe3XSsEWKlUrztb1V0euEcEvZNfABtsCnx2CfoUTdydWl05MxTOYaQRThFlLa2-ozLiy2XEUka0wJBFs5RyFjPiSZ4mSRz-qOfreCpygo-K_7jB63oUNfY4T_e4b1i_ZkiXwNGtR6etbx40i3U=" alt="Skapande av hashade saltade lösenord">
</div>
<div class="title">Skapande av hashade saltade lösenord</div>
</div>
<div class="imageblock flowchart kroki-format-svg kroki">
<div class="content">
<img src="https://kroki.io/plantuml/svg/eNqNkD1uwzAMRveegsjUIkudNj9IkbFAUHTs2IWyaFmIRAcyW-RAzhVyAV2sslLXSadMAj6K75FcfyCQbwRIBJC_Y8caA6NnaMoaXDy1xE3QYGHnMAgdBD4Z7ic1eWeNTB5e7tbb2HnBsZ24hRadoCaosa37dyRVIR4ZNAoqTNEZV5JeLmdqpYiesVCzxxVVaq5IL6rVYjEvpqjKYvaUda8HCVhTwCxJhDPxSu_QhF47jDHqs-6C9h47Y0CscwNuH4-gScCyx9w8bP4HoesjXNC2_bqjbdojwZNOUef36XM-CFs2qWKaYMXfdoBMf0uQKp5CGo_BEFOgMBw5Jb2nn-3_8r_lL0HO2W1G2Gzghql-AK7NzMM=" alt="Kontroll av inmatade lösenord">
</div>
<div class="title">Kontroll av inmatade lösenord</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_templates">Templates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>En <em>template</em> (svenska: mall) låter oss blanda text (i vårt fall HTML) och Ruby-kod. Man kan skriva templates i template-språket <strong>ERB</strong> (<strong>E</strong>mbedded <strong>R</strong>u<strong>b</strong>y).</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Variabler från routes</div>
<div class="paragraph">
<p>För att variabler definerade i en route ska vara tillgängliga i en mall behöver variabeln vara en så-kallad <em>instansvariabel</em>. En instansvariabel skapas genom att man sätter ett <code>@</code> framför variabelns namn, t.ex  <code>@weather</code> eller <code>@city</code>.</p>
</div>
<div class="listingblock">
<div class="title">En route med instansvariabel</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre><span class="n">get</span> <span class="s1">'/weather/:city'</span> <span class="k">do</span> <span class="o">|</span><span class="n">city</span><span class="o">|</span>
  <span class="vi">@city</span> <span class="o">=</span> <span class="n">city</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="n">precipitation</span> <span class="o">=</span> <span class="mi">100</span> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="n">erb</span> <span class="ss">:weather</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@city</code> kommer gå att använda inne i erb-mallen</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>precipitation</code> kommer inte gå att använde i erb-mallen.</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>I en ERB-fil skriver man HTML som vanligt, och där man vill använda Ruby-kod omger man den med <code>&lt;%= din_kod_här %&gt;</code> eller <code>&lt;% din_kod_här %&gt;</code>.</p>
</div>
<div class="paragraph">
<p>Skillnaden mellan kodblock som börjar med <code>&lt;%=</code> och <code>&lt;%</code> är att resultatet av block som börjar med <code>&lt;%=</code> kommer visas på sidan, medans resultatet av block som börjar med <code>&lt;%</code> <em>inte</em> kommer visas på sidan, men koden kommer att köras.</p>
</div>
<div class="listingblock">
<div class="title">En erb-mall med två kodblock</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="erb"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
</pre></td><td class="code"><pre><span class="nt">&lt;h1&gt;</span>3 + 1 blir <span class="cp">&lt;%=</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="nt">&lt;h1&gt;</span>3 + 1 blir <span class="cp">&lt;%</span>  <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Resultatet kommer synas på sidan.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Resultatet kommer <em>inte</em> synas på sidan.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Föregående erb-mall kommer renderas till följande HTML</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="html"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
</pre></td><td class="code"><pre><span class="nt">&lt;h1&gt;</span>3 + 1 blir 4<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;h1&gt;</span>3 + 1 blir <span class="nt">&lt;/h1&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>&lt;% %&gt;</code> (utan <code>=</code>) används framförallt för loopar och if-satser, där själva if-satsen eller loopen inte ska visas på sidan. Inuti loopen eller if-satsen använder man <code>&lt;%= %&gt;</code> för att visa innehåll</p>
</div>
<div class="listingblock">
<div class="title">En erb-mall med en if-sats</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="erb"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span class="cp">&lt;%</span> <span class="k">if</span> <span class="vi">@weather</span> <span class="o">==</span> <span class="s1">'raining'</span> <span class="cp">%&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">'/img/rain.png'</span><span class="nt">&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="nt">&lt;span&gt;</span>Nederbörd: <span class="cp">&lt;%=</span> <span class="vi">@precipitation</span> <span class="cp">%&gt;</span> mm<span class="nt">&lt;/span&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span> <i class="conum" data-value="4"></i><b>(4)</b>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Själva if-satsen ska inte synas på sidan, därför används <code>&lt;% &#8230;&#8203; %&gt;</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Allt mellan <code>if</code>-blocket och <code>end-blocket</code> kommer visas på sidan om if-satsen är <code>true</code>. Om den är <code>false</code>, kommer <em>inget</em> visas.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>&lt;%= &#8230;&#8203; %&gt;</code> används eftersom innehållet i variabeln ska visas.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>end</code> ska inte visas på sidan, därför används <code>&lt;% &#8230;&#8203; %&gt;</code>.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Föregående mall renderad till HTML (om <code>@weather</code>  är 'raining' och <code>@precipitation</code> är 3)</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="html"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
</pre></td><td class="code"><pre><span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">'/img/rain.png'</span><span class="nt">&gt;</span>
<span class="nt">&lt;span&gt;</span>Nederbörd: 3 mm<span class="nt">&lt;/span&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">En erb-mall med en each-loop</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="erb"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span class="nt">&lt;ol&gt;</span>
<span class="hll">  <span class="cp">&lt;%</span> <span class="vi">@cities</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">city</span><span class="o">|</span> <span class="cp">%&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
</span><span class="hll">    <span class="nt">&lt;li&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
</span><span class="hll">      <span class="nt">&lt;h3&gt;</span><span class="cp">&lt;%=</span> <span class="n">city</span><span class="p">.</span><span class="nf">capitalize</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h3&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>
</span><span class="hll">        <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">'/img/</span><span class="cp">&lt;%=</span> <span class="n">city</span><span class="p">.</span><span class="nf">downcase</span> <span class="cp">%&gt;</span><span class="s">.png'</span><span class="nt">&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>
</span><span class="hll">      <span class="nt">&lt;/li&gt;</span>
</span><span class="hll">  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span> <i class="conum" data-value="4"></i><b>(4)</b>
</span><span class="nt">&lt;/ol&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Själva each-loopen ska inte synas på sidan, därför används <code>&lt;% &#8230;&#8203; %&gt;</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Alla element mellan <code>each</code>-blocket och <code>end-blocket</code> kommer visas på sidan för varje grej i <code>@cities</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>&lt;%= &#8230;&#8203; %&gt;</code> används eftersom resultatet av koden ska visas.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>end</code> ska inte visas på sidan, därför används <code>&lt;% &#8230;&#8203; %&gt;</code>.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Föregående mall renderad till HTML (om <code>@cities</code> är <code>['copenhagen', 'gothenburg', 'OSLO']</code>)</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="html"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
</pre></td><td class="code"><pre><span class="nt">&lt;ol&gt;</span>
  <span class="nt">&lt;li&gt;</span>
    <span class="nt">&lt;h3&gt;</span>Copenhagen<span class="nt">&lt;/h3&gt;</span>
    <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">'/img/copenhagen.png'</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span>
    <span class="nt">&lt;h3&gt;</span>Gothenburg<span class="nt">&lt;/h3&gt;</span>
    <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">'/img/gothenburg.png'</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span>
    <span class="nt">&lt;h3&gt;</span>Oslo<span class="nt">&lt;/h3&gt;</span>
    <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">'/img/oslo.png'</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ol&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_formulär">Formulär</h3>
<div class="paragraph">
<p>För att skicka data från användaren till Servern används formulär.</p>
</div>
<div class="listingblock">
<div class="title">Ett formulär</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="erb"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="c">&lt;!-- Övrig HTML --&gt;</span>
<span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">'/fruits'</span> <span class="na">method=</span><span class="s">"POST"</span><span class="nt">&gt;</span><i class="conum" data-value="1"></i><b>(1)</b>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">'text'</span> <span class="na">name=</span><span class="s">"fruit"</span> <span class="na">placeholder=</span><span class="s">"Fruit name"</span><span class="nt">&gt;&lt;/input&gt;</span><i class="conum" data-value="2"></i><b>(2)</b>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">'number'</span> <span class="na">name=</span><span class="s">"rating"</span><span class="nt">&gt;&lt;/input&gt;</span><i class="conum" data-value="2"></i><b>(2)</b>
  <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">'submit'</span><span class="nt">&gt;</span>Create new fruit rating<span class="nt">&lt;/button&gt;</span><i class="conum" data-value="3"></i><b>(3)</b>
<span class="nt">&lt;/form&gt;</span>
<span class="c">&lt;!-- Övrig HTML --&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>action</code> är vilken <strong>route</strong> datan ska skickas till på servern, <code>method</code> är vilket HTTP-verb som ska användas (nästan alltid <code>POST</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Ett text-input-element. <code>name</code>-attributet anger vilken <strong>parameter</strong> som kommer innehålla input-elementets värde</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Ett submit-knapp-element. När knappen klickas kommer webbläsaren göra en <code>POST</code>-request till <code>/fruits</code> med datan från formuläret.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_formulär_element">Formulär-element</h3>
<div class="paragraph">
<p>För att skicka data med ett formulär behöver man olika element att "mata in" datan i.</p>
</div>
<div class="paragraph">
<p>Följande element är vanliga i formulär:</p>
</div>
<div class="sect3">
<h4 id="_input">input</h4>
<div class="paragraph">
<p>Ofta en ruta man kan mata in värden i. Det finns flera olika typer av input-element: <code>text</code>, <code>number</code>, <code>password</code>, <code>email</code>, <code>search</code>, etc</p>
</div>
<div class="listingblock">
<div class="title">Några olika input-element</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="html"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre><span class="c">&lt;!-- i ett form-element --&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">'text'</span> <span class="na">name=</span><span class="s">"fruit"</span> <span class="na">placeholder=</span><span class="s">"Fruit name"</span><span class="nt">&gt;&lt;/input&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">'number'</span> <span class="na">name=</span><span class="s">"rating"</span><span class="nt">&gt;&lt;/input&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">'email'</span> <span class="na">name=</span><span class="s">"email"</span><span class="nt">&gt;&lt;/input&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">'search'</span> <span class="na">name=</span><span class="s">"query"</span><span class="nt">&gt;&lt;/input&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<input type="text" name="fruit" placeholder="Fruit name"></input>
<input type='number' name="rating"></input>
<input type='email' name="email"></input>
<input type='search' name="query"></input>
<div class="paragraph">
<p>Läs mer om <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input">input-elementen på MDN</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_checkbox">checkbox</h4>
<div class="paragraph">
<p>En ruta som kan vara eller inte vara ikryssad. Egentligen en typ av input-element.</p>
</div>
<div class="listingblock">
<div class="title">Två checkboxes</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="html"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span class="c">&lt;!-- i ett form-element --&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">name=</span><span class="s">"hungry"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">name=</span><span class="s">"thirsty"</span> <span class="na">checked</span> <span class="nt">/&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<input type="checkbox" name="hungry" />
<input type="checkbox" name="thirsty" checked />
<div class="paragraph">
<p>Läs mer om <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/checkbox">checkbox  på MDN</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_textarea">textarea</h4>
<div class="paragraph">
<p>Ett text-input-element med flera rader</p>
</div>
<div class="listingblock">
<div class="title">En textarea</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="html"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
</pre></td><td class="code"><pre><span class="c">&lt;!-- i ett form-element --&gt;</span>
<span class="nt">&lt;textarea</span> <span class="na">name=</span><span class="s">"message"</span> <span class="nt">/&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<textarea name="message"></textarea>
<div class="paragraph">
<p>Läs mer om <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/textarea">textarea på MDN</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_select_och_option">select och option</h4>
<div class="paragraph">
<p>En select är en slags dropdown-lista, där alternativen ligger i option-element.</p>
</div>
<div class="listingblock">
<div class="title">Ett select-element med 4 alternativ</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="html"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre><span class="c">&lt;!-- i ett form-element --&gt;</span>
<span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">"fruits"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">""</span><span class="nt">&gt;</span>--Välj en frukt--<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"banana"</span><span class="nt">&gt;</span>Banan<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"pear"</span><span class="nt">&gt;</span>Päron<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"apple"</span><span class="nt">&gt;</span>Äpple<span class="nt">&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"orange"</span><span class="nt">&gt;</span>Apelsin<span class="nt">&lt;/option&gt;</span>
<span class="nt">&lt;/select&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<select name="fruits">
  <option value="">--Välj en frukt--</option>
  <option value="banana">Banan</option>
  <option value="pear">Päron</option>
  <option value="apple">Äpple</option>
  <option value="orange">Apelsin</option>
</select>
<div class="paragraph">
<p>Läs mer om <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/select">select på MDN</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_radio_button">radio button</h4>
<div class="paragraph">
<p>Som en select, fast med knappar istället. Enbart en kan vara aktiv åt gången. Egentligen en variant av input.</p>
</div>
<div class="listingblock">
<div class="title">En radio button med 4 alternativ</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="html"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre><span class="c">&lt;!-- i ett form-element --&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"fruit"</span> <span class="na">value=</span><span class="s">"pear"</span> <span class="na">checked</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"fruit"</span> <span class="na">value=</span><span class="s">"banana"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"fruit"</span> <span class="na">value=</span><span class="s">"apple"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"radio"</span> <span class="na">name=</span><span class="s">"fruit"</span> <span class="na">value=</span><span class="s">"orange"</span> <span class="nt">/&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<input type="radio" name="fruit" value="pear" checked />
<input type="radio" name="fruit" value="banana" />
<input type="radio" name="fruit" value="apple" />
<input type="radio" name="fruit" value="orange" />
<div class="paragraph">
<p>Läs mer om <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/radio">radio button på MDN</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_datalist">datalist</h4>
<div class="paragraph">
<p>En slags autocomplete-sök-lista (liknande en select, men man får skriva istället). Egentligen ett input-element som hämtar alternativen från ett datalist-element med options</p>
</div>
<div class="listingblock">
<div class="title">En datalist med 4 alternativ</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="html"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="c">&lt;!-- i ett form-element --&gt;</span>
<span class="nt">&lt;input</span> <span class="na">list=</span><span class="s">"fruits"</span> <span class="na">name=</span><span class="s">"fruit"</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;datalist</span> <span class="na">id=</span><span class="s">"fruits"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"Pear"</span><span class="nt">&gt;&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"Banana"</span><span class="nt">&gt;&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"Apple"</span><span class="nt">&gt;&lt;/option&gt;</span>
  <span class="nt">&lt;option</span> <span class="na">value=</span><span class="s">"Orange"</span><span class="nt">&gt;&lt;/option&gt;</span>
<span class="nt">&lt;/datalist&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<input list="fruits" name="fruit" />

<datalist id="fruits">
  <option value="Pear"></option>
  <option value="Banana"></option>
  <option value="Apple"></option>
  <option value="Orange"></option>
</datalist>
<div class="paragraph">
<p>Läs mer om <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/datalist">datalist på MDN</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_button">button</h4>
<div class="paragraph">
<p>En knapp (för att skicka in formulär t.ex)</p>
</div>
<div class="listingblock">
<div class="title">En submit-knapp</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="html"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
</pre></td><td class="code"><pre><span class="c">&lt;!-- i ett form-element --&gt;</span>
<span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">/&gt;</span>Skicka<span class="nt">&lt;/button&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<button type="submit"/>Skicka</button>
<div class="paragraph">
<p>Läs mer om <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/button">button på MDN</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_label">label</h4>
<div class="paragraph">
<p>Labels ger etiketter till andra form-element. Genom att sätt <code>for</code>-attributet på en label till ett annat elements <code>id</code>-attribut kopplas label till element</p>
</div>
<div class="listingblock">
<div class="title">Element med labels</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="html"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="c">&lt;!-- i ett form-element --&gt;</span>
<span class="nt">&lt;label</span> <span class="na">f</span> <span class="na">[or=</span><span class="s">"fruit"</span><span class="nt">&gt;</span>Frukt<span class="nt">&lt;/label&gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"fruit"</span> <span class="na">name=</span><span class="s">"fruit"</span><span class="nt">&gt;</span>

<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">id=</span><span class="s">"favourite"</span> <span class="na">name=</span><span class="s">"favourite"</span><span class="nt">&gt;</span>
<span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"favourite"</span><span class="nt">&gt;</span>Favorit?<span class="nt">&lt;/label&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<label for="fruit">Frukt</label>
<input type="text" id="fruit" name="fruit">

<input type="checkbox" id="favourite" name="favourite">
<label for="favourite">Favorit?</label>
<div class="paragraph">
<p>Läs mer om <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/label">labels på MDN</a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_arbetsflöde">Arbetsflöde</h2>
<div class="sectionbody">
<h5 id="_0_skriv_ner_vilka_resurser_applikationen_hanterar_och_vad_de_har_för_attribut" class="discrete">0. Skriv ner vilka <strong>resurser</strong> applikationen hanterar och vad de har för attribut.</h5>
<div class="paragraph">
<p>Exemplet nedan utgår för en applikation där användare kan lägga upp och visa kod-snippets.</p>
</div>
<div class="paragraph">
<p>Följ sen för varje resurs följande steg:</p>
</div>
<h5 id="_1_vilken_resurs_är_det_du_ska_jobba_med" class="discrete">1. Vilken <strong>resurs</strong> är det du ska jobba med?</h5>
<div class="paragraph">
<p>snippets</p>
</div>
<h5 id="_2_vad_är_basrouten_för_resursen" class="discrete">2. Vad är <strong>basrouten</strong>  för resursen?</h5>
<div class="paragraph">
<p><code>/snippets</code></p>
</div>
<h5 id="_3_vilken_action_är_det_du_ska_skapa" class="discrete">3. Vilken <strong>action</strong> är det du ska skapa?</h5>
<div class="paragraph">
<p><code>show</code></p>
</div>
<h5 id="_4_surfa_till_den_adress_som_är_aktuell_för_den_resurs_och_action_som_ska_ske" class="discrete">4. Surfa till den adress som är aktuell för den <strong>resurs</strong> och <strong>action</strong> som ska ske.</h5>
<div class="paragraph">
<p>Eftersom det är <code>show</code> som är action, behöver vi <code>id</code> för resursen. Vi testar med id 1 (detta förutsätter att resursen med id 1 redan finns i databasen, om inte, lägg till i <code>seed.rb</code> och seeda om.)
Basrouten är <code>/snippets</code> alltså blir adressen vi ska surfa till <code>/snippets/1</code></p>
</div>
<div class="paragraph">
<p>När du surfar till adressen ger Sinatra dig en kod du kan bygga vidare på.</p>
</div>
<h5 id="_5_lägg_till_sinatras_exempelkod_i_app_rb" class="discrete">5. Lägg till sinatras exempelkod i <code>app.rb</code>.</h5>
<div class="listingblock">
<div class="title">app.rb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre><span class="o">...</span>
  <span class="n">get</span> <span class="s1">'/snippets/1'</span> <span class="k">do</span>
    <span class="s1">'Hello, World!'</span>
  <span class="k">end</span>
<span class="o">...</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<h5 id="_6_testa_om_routen_fungerar_med_exempelkoden_genom_att_ladda_om_sidan_i_webbläsaren" class="discrete">6. Testa om routen fungerar med exempelkoden genom att ladda om sidan i webbläsaren.</h5>
<div class="paragraph">
<p>Ser du "Hello, World!" i webbläsaren?</p>
</div>
<div class="paragraph">
<p>Om inte: Är <code>app.rb</code> sparad? Finns det någon annan <em>route</em> tidigare som "krockar"?</p>
</div>
<h5 id="_7_skapa_en_view_för_routen_och_uppdatera_route_koden_att_använda_view_en_och_visa_exempeldatan_där_istället" class="discrete">7. Skapa en <code>view</code> för routen och uppdatera route-koden att använda <code>view</code>-en och visa exempeldatan där istället.</h5>
<div class="paragraph">
<p>i <code>views/snippets/show.erb</code></p>
</div>
<div class="listingblock">
<div class="title">views/snippets/show.erb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="erb"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre>  <span class="cp">&lt;%=</span> <span class="vi">@test</span> <span class="cp">%&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>i <code>app.rb</code></p>
</div>
<div class="listingblock">
<div class="title">app.rb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="o">...</span>
  <span class="n">get</span> <span class="s1">'/snippets/1'</span> <span class="k">do</span>
    <span class="vi">@test</span> <span class="o">=</span> <span class="s2">"Working?"</span>
    <span class="n">erb</span> <span class="ss">:'snippets/show'</span>
  <span class="k">end</span>
<span class="o">...</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ladda om webbsidan. Ser du "Working?"</p>
</div>
<h5 id="_8_i_routen_lägg_till_den_kod_du_tror_du_egentligen_behöver" class="discrete">8. I routen, lägg till den kod du tror du <strong>egentligen</strong> behöver.</h5>
<div class="paragraph">
<p>i <code>app.rb</code></p>
</div>
<div class="listingblock">
<div class="title">app.rb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="o">...</span>
  <span class="c1"># snippets#show</span>
  <span class="n">get</span> <span class="s1">'/snippets/:id'</span> <span class="k">do</span> <span class="o">|</span><span class="nb">id</span><span class="o">|</span>
    <span class="vi">@snippet</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="s1">'SELECT * FROM snippets WHERE id = ?'</span><span class="p">,</span> <span class="nb">id</span><span class="p">.</span><span class="nf">to_i</span><span class="p">).</span><span class="nf">first</span>
    <span class="n">erb</span> <span class="ss">:'snippets/show'</span>
  <span class="k">end</span>
<span class="o">...</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<h5 id="_9_om_du_pratar_med_databasen_skriv_ut_rå_datan_i_view_en_innan_du_försöker_jobba_med_den_strukturerade_datan" class="discrete">9. Om du pratar med databasen, skriv ut rå-datan i view-en innan du försöker jobba med den strukturerade datan.</h5>
<div class="paragraph">
<p>i <code>views/snippets/show.erb</code></p>
</div>
<div class="listingblock">
<div class="title">views/snippets/show.erb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="erb"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre><span class="cp">&lt;%=</span> <span class="vi">@snippet</span><span class="p">.</span><span class="nf">inspect</span> <span class="cp">%&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ser datan ut som du förväntar dig? Om du förväntar dig <strong>ett</strong> element, är det då ett element, eller är det en array?</p>
</div>
<div class="paragraph">
<p>Om datan ser fel ut, gå tillbaks till routen och fundera på hur du behöver förändra hur du hämtar/manipulerar datan innan du visar den.</p>
</div>
<h5 id="_10_iterera_övervisa_den_strukturerade_datan_i_html_på_rätt_sätt" class="discrete">10. Iterera över/visa den strukturerade datan i HTML på rätt sätt.</h5>
<div class="paragraph">
<p>i <code>views/snippets/show.erb</code></p>
</div>
<div class="listingblock">
<div class="title">views/snippets/show.erb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="erb"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre>  <span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@snippet</span><span class="p">[</span><span class="s1">'title'</span><span class="p">]</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>
  <span class="nt">&lt;pre&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="nt">&lt;code&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@snippet</span><span class="p">[</span><span class="s1">'code'</span><span class="p">]</span> <span class="cp">%&gt;</span><span class="nt">&lt;/code&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="nt">&lt;/pre&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>pre</code>-element bevarar radbrytningar etc</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>code</code>-element talar om för skärmläsare etc att innehållet är kod</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Ser sidan ut som du förväntar dig? Gå vidare till nästa resurs/action.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_automatisk_testning_med_cypress">Automatisk testning med Cypress</h2>
<div class="sectionbody">
<div class="paragraph">
<p>När man utvecklar en applikation testar man kontinuerligt att den fungerar som den ska, genom att manuellt ladda om sidan och se att det man just skapat fungerar som det ska. Detta är dock inte en hållbar lösning i längden, då det tar mycket tid och är lätt att missa något.</p>
</div>
<div class="paragraph">
<p>Det är också vanligt att man, när man gör en ändring som man <strong>tror</strong> inte påverkar något annat, råkar förstöra något annat i applikationen, utan att man märker det.</p>
</div>
<div class="paragraph">
<p>Därför är det viktigt att automatisera testningen av applikationen. Det finns många olika verktyg för att göra detta. I den här kursen kommer vi använda Cypress, som är ett verktyg för att skriva och köra tester på webbapplikationer.</p>
</div>
<div class="sect2">
<h3 id="_installation">Installation</h3>
<div class="paragraph">
<p>Cypress ska installeras i Windows, inte i WSL, eftersom det inte fungerar att köra grafiska program i WSL. Alla instruktioner nedan ska alltså köras i Windows.</p>
</div>
<div class="sect3">
<h4 id="_installera_node_js">Installera Node.js</h4>
<div class="paragraph">
<p>För att köra Cypress behöver du först installera node.js. Gå till <a href="https://nodejs.org/en/download" class="bare">nodejs.org/en/download</a> och ladda ner och installera den senaste versionen av Node.js.</p>
</div>
<div class="paragraph">
<p>Om du är osäker på hur du ska installera Node.js kan du följa instruktionerna på <a href="https://www.geeksforgeeks.org/installation-of-node-js-on-windows/" class="bare">www.geeksforgeeks.org/installation-of-node-js-on-windows/</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_installera_cypress">Installera Cypress</h4>
<div class="paragraph">
<p>När du har installerat Node.js kan du installera Cypress genom att köra följande kommando i terminalen:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh">npm <span class="nb">install</span> <span class="nt">-g</span> cypress</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_starta_cypress">Starta Cypress</h3>
<div class="paragraph">
<p>När du har installerat Cypress kan du starta det genom att köra följande kommando i terminalen (i src-mappen i ditt projekt):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sh">cypress open</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cypress öppnar nu följande fönster:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/testing/images/1.png" alt="1">
</div>
</div>
<div class="paragraph">
<p>Klicka på "browse manually" och leta reda på src-mappen för ditt projekt.</p>
</div>
<div class="paragraph">
<p>Välj E2E-testing (E2E betyger End-to-End, dvs att allt testas, från databas till användargränssnitt)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/testing/images/2.png" alt="2">
</div>
</div>
<div class="paragraph">
<p>Klicka på "Continue"</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/testing/images/3.png" alt="3">
</div>
</div>
<div class="paragraph">
<p>Välj "Start E2E testing in Chrome"</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/testing/images/4.png" alt="4">
</div>
</div>
<div class="paragraph">
<p>Välj "Create new spec"</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/testing/images/5.png" alt="5">
</div>
</div>
<div class="paragraph">
<p>Klicka på "Run the spec"</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/testing/images/6.png" alt="6">
</div>
</div>
<div class="paragraph">
<p>Testet körs nu i Cypress-fönstret.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/testing/images/7.png" alt="7">
</div>
</div>
<div class="paragraph">
<p>I din mappstruktur kommer det nu att skapas en mapp som heter <code>cypress</code>, testet som skapades i cypress-fönstret ligger i <code>cypress/e2e</code>. Om du öppnar filen i VS Code ser du testet som kördes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nf">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">template spec</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nf">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">passes</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">cy</span><span class="p">.</span><span class="nf">visit</span><span class="p">(</span><span class="dl">'</span><span class="s1">https://example.cypress.io</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">})</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_skriva_egna_tester">Skriva egna tester</h3>
<div class="paragraph">
<p>Ett test består av två delar: en <code>describe</code>-funktion och en <code>it</code>-funktion. <code>describe</code>-funktionen beskriver vad testet handlar om, och <code>it</code>-funktionen beskriver vad som ska testas.</p>
</div>
<div class="paragraph">
<p>I exemplet ovan beskriver <code>describe</code>-funktionen att det är ett test för en template, och <code>it</code>-funktionen beskriver att testet ska passera om sidan <code><a href="https://example.cypress.io" class="bare">example.cypress.io</a></code> laddas.</p>
</div>
<div class="paragraph">
<p><code>describe`</code> gör inget mer än att det grupperar massa texter. Argumentet som skickas till describe används bara för att visa vilka test som hör ihop.</p>
</div>
<div class="paragraph">
<p><code>it</code> är det som faktiskt testar något. Argumentet som skickas till <code>it</code> används för att visa vad som testas i cypress-fönstret.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="chapters/testing/images/8.png" alt="8">
</div>
</div>
<div class="sect3">
<h4 id="_ett_första_test">Ett första test</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nf">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="nx">cy</span><span class="p">.</span><span class="nf">visit</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://localhost:9292/thesaurus</span><span class="dl">'</span><span class="p">)</span>
<span class="p">})</span>

<span class="nf">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">Thesaurus</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <i class="conum" data-value="2"></i><b>(2)</b>

  <span class="nf">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">shows a list of words</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="nx">cy</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">li</span><span class="dl">'</span><span class="p">).</span><span class="nf">should</span><span class="p">(</span><span class="dl">'</span><span class="s1">exist</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">})</span>

  <span class="nf">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">has links to words</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="nx">cy</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">li a</span><span class="dl">'</span><span class="p">).</span><span class="nf">then</span><span class="p">(</span><span class="nx">words</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">word</span> <span class="o">=</span> <span class="nx">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nx">cy</span><span class="p">.</span><span class="nf">visit</span><span class="p">(</span><span class="nx">word</span><span class="p">.</span><span class="nx">href</span><span class="p">)</span>
    <span class="p">})</span>
  <span class="p">})</span>

  <span class="nf">it</span><span class="p">(</span><span class="dl">'</span><span class="s1">clicking a word shows a list of related words</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <i class="conum" data-value="5"></i><b>(5)</b>
    <span class="nx">cy</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="p">).</span><span class="nf">contains</span><span class="p">(</span><span class="dl">'</span><span class="s1">abbey</span><span class="dl">'</span><span class="p">).</span><span class="nf">click</span><span class="p">();</span>
    <span class="nx">cy</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="dl">'</span><span class="s1">church</span><span class="dl">'</span><span class="p">)</span>
    <span class="nx">cy</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="dl">'</span><span class="s1">monastery</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">})</span>

<span class="p">})</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>beforeEach</code> körs innan varje <code>it</code>. Här besöker vi sidan som vi vill testa.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>describe</code>-funktionen beskriver att det är ett test för thesaurus.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>it</code>-funktionen beskriver att testet ska passera om det finns en lista (förhoppningsvis med ord).</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>it</code>-funktionen beskriver att testet ska passera om det finns en länk till ett ord</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>it</code>-funktionen beskriver att testet ska passera om det går att klicka på ett ord och få upp en lista med relaterade ord</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_vanliga_saker_att_testa">Vanliga saker att testa</h4>
<div class="sect4">
<h5 id="_visas_rätt_sak_på_skärmen">Visas rätt sak på skärmen?</h5>
<div class="paragraph">
<p>Det finns två sätt att testa om rätt sak visas på skärmen: <code>cy.contains</code> och <code>cy.get</code>.</p>
</div>
<div class="paragraph">
<p><code>cy.get</code> tar en css-selektor som argument. Cypress kommer att leta efter ett element som matchar css-selektorn i DOM:en. Om det finns en matchning kommer testet att passera.</p>
</div>
<div class="paragraph">
<p><code>cy.contains</code> tar en sträng som argument. Cypress kommer att leta efter en matchning för strängen i DOM:en. Om det finns en matchning kommer testet att passera.</p>
</div>
<div class="listingblock">
<div class="title">Exempel</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">cy</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="dl">'</span><span class="s1">Login</span><span class="dl">'</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="nx">cy</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">button</span><span class="dl">'</span><span class="p">).</span><span class="nf">contains</span><span class="p">(</span><span class="dl">'</span><span class="s1">Login</span><span class="dl">'</span><span class="p">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="nx">cy</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">nav form#logout button</span><span class="dl">'</span><span class="p">).</span><span class="nf">should</span><span class="p">(</span><span class="dl">'</span><span class="s1">have.text</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Logout</span><span class="dl">'</span><span class="p">)</span> <i class="conum" data-value="3"></i><b>(3)</b>
<span class="nx">cy</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">.item</span><span class="dl">'</span><span class="p">).</span><span class="nf">should</span><span class="p">(</span><span class="dl">'</span><span class="s1">have.length</span><span class="dl">'</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Testar om texten 'Login' finns någonstans på sidan</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Testar om det finns en knapp med texten 'Login' någonstans på sidan</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Testar om det finns en knapp med texten 'Logout' i en form med id logout i en nav</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Testar om det finns tre element med klassen 'item' på sidan</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_skapas_rätt_saker_när_man_fyller_i_formulär">Skapas rätt saker när man fyller i formulär?</h5>
<div class="paragraph">
<p>För att fylla i formulär används <code>cy.get</code> och <code>.type</code> tillsammans. <code>.type</code> tar en sträng som argument och skriver in den i det element som matchar css-selektorn.</p>
</div>
<div class="listingblock">
<div class="title">Exempel</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">cy</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">input[name="comment"]</span><span class="dl">'</span><span class="p">).</span><span class="nf">type</span><span class="p">(</span><span class="dl">'</span><span class="s1">This is my comment</span><span class="dl">'</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="nx">cy</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">form</span><span class="dl">'</span><span class="p">).</span><span class="nf">submit</span><span class="p">()</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="nx">cy</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="dl">'</span><span class="s1">This is my comment</span><span class="dl">'</span><span class="p">)</span> <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Skriver in texten 'This is my comment' i ett input-element med namnet 'comment'</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Skickar formuläret</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Testar om texten 'This is my comment' finns någonstans på sidan (som man skickats till efter formuläret skickats)</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_fungerar_inloggnignsfunktionen">Fungerar inloggnignsfunktionen?</h5>
<div class="listingblock">
<div class="title">Exempel</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">cy</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">input[name="username"]</span><span class="dl">'</span><span class="p">).</span><span class="nf">type</span><span class="p">(</span><span class="dl">'</span><span class="s1">admin</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">cy</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">input[name="password"]</span><span class="dl">'</span><span class="p">).</span><span class="nf">type</span><span class="p">(</span><span class="dl">'</span><span class="s1">password</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">cy</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">form</span><span class="dl">'</span><span class="p">).</span><span class="nf">submit</span><span class="p">()</span>
<span class="nx">cy</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="dl">'</span><span class="s1">Welcome admin</span><span class="dl">'</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Exempel</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">cy</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">button.logout</span><span class="dl">'</span><span class="p">].</span><span class="nf">click</span><span class="p">()</span>
<span class="nx">cy</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="dl">'</span><span class="s1">Logga in</span><span class="dl">'</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_fungerar_länkar">Fungerar länkar?</h5>
<div class="listingblock">
<div class="title">Exempel</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">cy</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="p">).</span><span class="nf">contains</span><span class="p">(</span><span class="dl">'</span><span class="s1">Home</span><span class="dl">'</span><span class="p">).</span><span class="nf">click</span><span class="p">()</span>
<span class="nx">cy</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="dl">'</span><span class="s1">Welcome to our website</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">cy</span><span class="p">.</span><span class="nf">href</span><span class="p">().</span><span class="nf">should</span><span class="p">(</span><span class="dl">'</span><span class="s1">eq</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">http://localhost:9292/</span><span class="dl">'</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_fungerar_rättighetskontroller">Fungerar rättighetskontroller?</h5>
<div class="listingblock">
<div class="title">Exempel</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="js"><span class="nx">cy</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">input[name="username"]</span><span class="dl">'</span><span class="p">).</span><span class="nf">type</span><span class="p">(</span><span class="dl">'</span><span class="s1">notadmin</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">cy</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">input[name="password"]</span><span class="dl">'</span><span class="p">).</span><span class="nf">type</span><span class="p">(</span><span class="dl">'</span><span class="s1">password</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">cy</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">form</span><span class="dl">'</span><span class="p">).</span><span class="nf">submit</span><span class="p">()</span>

<span class="nx">cy</span><span class="p">.</span><span class="nf">visit</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://localhost:9292/admin</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">cy</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="dl">'</span><span class="s1">You do not have permission to access this page</span><span class="dl">'</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_fil_och_mappstruktur">Fil- och mappstruktur</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ett Sinatraprojekt innehåller följande filer och mappar:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>fruit-o-Matic <i class="conum" data-value="1"></i><b>(1)</b>
|
├── Gemfile
├── Gemfile.lock
├── app.rb
├── config.ru
├── public
│   ├── css
│   │   └── style.css
│   ├── img
│   │   └── fruit.png
│   └── js
│       └── script.js
└── views
    ├── fruits
    │   ├── index.erb
    │   └── show.erb
    ├── index.erb
    └── layout.erb</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Varje Sinatraprojekt måste ligga i en egen mapp, i det här fallet <code>fruit-o-matic</code>.</td>
</tr>
</table>
</div>
<h3 id="_gemfile_gemfile_lock" class="discrete">Gemfile &amp; Gemfile.lock</h3>
<div class="paragraph">
<p><code>Gemfile</code> berättar vilka bibliotek (i Ruby kallas biblioteken för "gems") vår applikation behöver.</p>
</div>
<div class="paragraph">
<p>För att installera biblioteken som finns i <code>Gemfile</code> kör man kommandot <code>bundle install</code> i terminalen i samma mapp som <code>Gemfile</code> ligger.</p>
</div>
<div class="paragraph">
<p>När man kör <code>bundle install</code> kommer filen <code>Gemfile.lock</code> skapas. Den innehåller vilken version av biblioteken som installerades.</p>
</div>
<div class="listingblock">
<div class="title">Gemfile</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="n">source</span> <span class="s1">'https://rubygems.org'</span> <i class="conum" data-value="1"></i><b>(1)</b>

<span class="n">gem</span> <span class="s1">'thin'</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="n">gem</span> <span class="s1">'sinatra'</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="n">gem</span> <span class="s1">'rerun'</span> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Talar om för bundler var biblioteken vi ska använda finns.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Vilka gems (bibliotek) som ska installeras</td>
</tr>
</table>
</div>
<h3 id="_app_rb" class="discrete">app.rb</h3>
<div class="paragraph">
<p>I <code>app.rb</code> skapar vi vår applikation och definerar våra routes.</p>
</div>
<div class="listingblock">
<div class="title">app.rb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">App</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span> <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="n">get</span> <span class="s1">'/'</span> <span class="k">do</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="n">erb</span> <span class="ss">:index</span>
    <span class="k">end</span>

    <span class="n">get</span> <span class="s1">'/fruits'</span> <span class="k">do</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="n">erb</span> <span class="ss">:'fruits/index'</span>
    <span class="k">end</span>

<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Talar om att filen innehåller en Sinatra-applikation.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Gör så att innehållet i <code>views/index.erb</code> renderas när man surfar till root-url:en ('/').</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Gör så att innehållet i <code>views/fruit/index.erb</code> renderas när man surfar till '/fruits'.</td>
</tr>
</table>
</div>
<h3 id="_config_ru" class="discrete">config.ru</h3>
<div class="paragraph">
<p><code>config.ru</code> nvänds av <code>rackup</code> för att starta applikationen (<code>ru</code> i <code>config.ru</code> står för <code><strong>r</strong>ack<strong>u</strong>p</code>).</p>
</div>
<div class="listingblock">
<div class="title">config.ru</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><span class="nb">require</span> <span class="s1">'bundler'</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="no">Bundler</span><span class="p">.</span><span class="nf">require</span>   <i class="conum" data-value="2"></i><b>(2)</b>
<span class="nb">require_relative</span> <span class="s1">'app'</span> <i class="conum" data-value="3"></i><b>(3)</b>
<span class="n">run</span> <span class="no">App</span> <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Gör så vi kan använda bundler för att läsa in biblioteken i <code>Gemfile</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Läser in biblioteken i <code>Gemfile</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Läser in <code>app.rb</code>,</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Säger till <code>rackup</code> att starta applikationen App från <code>app.rb</code> (se rad 1 i <code>app.rb</code>).</td>
</tr>
</table>
</div>
<h3 id="_public_mappen" class="discrete">public-mappen</h3>
<div class="paragraph">
<p>I <code>public</code>-mappen lägger man statiska resurser som bilder, css och js - oftast i separata undermappar så det inte blir för rörigt.</p>
</div>
<h3 id="_views_mappen" class="discrete">views-mappen</h3>
<div class="paragraph">
<p>I <code>views</code>-mappen lägger man sina templates/mallar - ofta i separata undermappar så det inte blir för rörigt när man har flera resurser i sin app.</p>
</div>
<div class="sect2">
<h3 id="_moduler">Moduler</h3>
<div class="paragraph">
<p>Efter ett tag, när applikationen blir större, blir det rörigt att ha all kod i <code>app.rb</code>. Då behöver man bryta ut koden i moduler.</p>
</div>
<div class="paragraph">
<p>En modul är en fil som innehåller kod (funktioner) som hör ihop.</p>
</div>
<div class="paragraph">
<p>I Webbserverprogrammering 1 kommer vi att använda moduler för att bryta ut kod som pratar med databasen. Vi kommer använda en modul för varje tabell i databasen.</p>
</div>
<div class="paragraph">
<p>Genom att använda moduler kan vi gå från kod i <code>app.rb</code> som ser ut så här:</p>
</div>
<div class="listingblock">
<div class="title">app.rb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">App</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>

    <span class="k">def</span> <span class="nf">db</span>
        <span class="k">if</span> <span class="vi">@db</span> <span class="o">==</span> <span class="kp">nil</span>
            <span class="vi">@db</span> <span class="o">=</span> <span class="no">SQLite3</span><span class="o">::</span><span class="no">Database</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'./db/db.sqlite'</span><span class="p">)</span>
            <span class="vi">@db</span><span class="p">.</span><span class="nf">results_as_hash</span> <span class="o">=</span> <span class="kp">true</span>
        <span class="k">end</span>
        <span class="k">return</span> <span class="vi">@db</span>
    <span class="k">end</span>

    <span class="o">...</span>

    <span class="n">get</span> <span class="s1">'/fruits'</span> <span class="k">do</span>
        <span class="vi">@user</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="s1">'SELECT * FROM users WHERE id = ?'</span><span class="p">,</span> <span class="n">session</span><span class="p">[</span><span class="ss">:user_id</span><span class="p">]).</span><span class="nf">first</span>
        <span class="vi">@fruits</span> <span class="o">=</span> <span class="n">db</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="s1">'SELECT * FROM fruits'</span><span class="p">)</span>
        <span class="n">erb</span> <span class="ss">:'fruits/index'</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Till kod som ser ut såhär:</p>
</div>
<div class="listingblock">
<div class="title">app.rb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
</pre></td><td class="code"><pre><span class="nb">require_relative</span> <span class="s1">'models/user'</span>
<span class="nb">require_relative</span> <span class="s1">'models/fruit'</span>

<span class="k">class</span> <span class="nc">App</span> <span class="o">&lt;</span> <span class="no">Sinatra</span><span class="o">::</span><span class="no">Base</span>

    <span class="n">get</span> <span class="s1">'/fruits'</span> <span class="k">do</span>
        <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="ss">:user_id</span><span class="p">])</span>
        <span class="vi">@fruits</span> <span class="o">=</span> <span class="no">Fruit</span><span class="p">.</span><span class="nf">all</span>
        <span class="n">erb</span> <span class="ss">:'fruits/index'</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Detta gör att koden blir mer lättläst och underhållbar, man tappar inte bort sig bland alla SQL-frågor och databasoperationer i <code>app.rb</code>.</p>
</div>
<div class="paragraph">
<p>För att åstadkomma detta skapar vi en mapp som heter <code>models</code> och lägger våra moduler där (moduler som pratar med databasen kallas traditionellt för  "models").</p>
</div>
<div class="paragraph">
<p>En modul är en fil som innehåller en <code>module</code>-deklaration:</p>
</div>
<div class="listingblock">
<div class="title">models/fruit.rb</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="ruby"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="code"><pre><span class="k">module</span> <span class="nn">Fruit</span> <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">all</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="n">db</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="s1">'SELECT * FROM fruits'</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">find</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="n">db</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="s1">'SELECT * FROM fruits WHERE id = ?'</span><span class="p">,</span> <span class="nb">id</span><span class="p">).</span><span class="nf">first</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">most_popular</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="n">db</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="s1">'SELECT * FROM fruits ORDER BY popularity DESC LIMIT ?'</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">db</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="k">if</span> <span class="vi">@db</span> <span class="o">==</span> <span class="kp">nil</span>
            <span class="vi">@db</span> <span class="o">=</span> <span class="no">SQLite3</span><span class="o">::</span><span class="no">Database</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'./db/db.sqlite'</span><span class="p">)</span>
            <span class="vi">@db</span><span class="p">.</span><span class="nf">results_as_hash</span> <span class="o">=</span> <span class="kp">true</span>
        <span class="k">end</span>
        <span class="k">return</span> <span class="vi">@db</span>
    <span class="k">end</span>

<span class="k">end</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Skapar en modellen <code>Fruit</code> i modulen <code>Fruit</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Skapar metoderna <code>Fruit.all</code>, <code>Fruit.find(id)</code> och <code>Fruit.most_popular(amount)</code>, som vi kan anropa från <code>app.rb</code> (en metod är en funktion som är definerad i en modul).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Koden för att skapa databasanslutningen flyttas från <code>app.rb</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Namnet på metoderna (<code>all</code>, <code>find</code>, <code>most_popular</code>) är godtyckliga, de kan heta vad som helst, men det är en bra idé att använda namn som beskriver vad metoden gör.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_linux">Linux</h2>
<div class="sectionbody">
<h3 id="_kommandon" class="discrete">Kommandon</h3>
<div class="dlist glossary">
<dl>
<dt>cat</dt>
<dd>
<p>Används för att visa innehållet i en fil <code>cat app.rb</code></p>
</dd>
<dt>cd</dt>
<dd>
<p>Navigera mellan mappar. Fungerar som i Windows, men blanksteg krävs vid <code>cd ..</code></p>
</dd>
<dt>ctrl+c</dt>
<dd>
<p>Avbryter den process som körs för stunden.</p>
</dd>
<dt>killall</dt>
<dd>
<p>Används för att avbryta en process som körs i bakgrunden: <code>killall ruby</code>.</p>
</dd>
<dt>ls</dt>
<dd>
<p>Lista filer i nuvarande mapp (som <code>dir</code> i Windows).</p>
</dd>
<dt>mkdir</dt>
<dd>
<p>Skapar en mapp i den aktuella sökvägen: <code>mkdir grillkorv</code></p>
</dd>
<dt>pwd</dt>
<dd>
<p>Skriv ut sökvägen till aktuell mapp.</p>
</dd>
<dt>rm</dt>
<dd>
<p>Tar bort en fil (obs den hamnar EJ i papperskorgen): <code>rm grillkorv.rb</code></p>
</dd>
<dt>su</dt>
<dd>
<p>Används för att byta användare: <code>su wsl</code> byter till användaren "wsl". Gör detta om du ser typ <code>root@<strong><strong></strong></strong>**:/mnt&#8230;&#8203;.</code> i terminalen (då bör du se <code>→ wsp</code> istället)</p>
</dd>
<dt>sudo</dt>
<dd>
<p>Används för att köra kommandom med root- (administratörs-)behörighet ex <code>sudo killall ruby</code>.</p>
</dd>
<dt>touch</dt>
<dd>
<p>Skapar en ny tom fil <code>touch grillkorv.rb</code></p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_installation_och_konfigurering">Installation och konfigurering</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Börja med att göra alla uppdateringar i Windows update.</p>
</div>
<h3 id="_windows_terminal" class="discrete">Windows Terminal</h3>
<div class="paragraph">
<p>Windows Terminal är en bättre terminal än Windows Command Prompt (cmd).
<a href="https://apps.microsoft.com/store/detail/windows-terminal/9N0DX20HK701">Installera från Microsoft Store</a></p>
</div>
<h3 id="_wsl" class="discrete">WSL</h3>
<div class="paragraph">
<p>I stort sett all webbserverprogrammering sker nuförtiden på Linux- eller linux-kompatibla operatisystem.
Därför är de flesta guider och bibliotek (samlingar med kod som utvecklare kan använda) skrivna för Linux.</p>
</div>
<div class="paragraph">
<p>Eftersom Windows inte är ett linuxkompatibelt operativsystem kommer vi installera WSL - Windows Subsystem for Linux.
WSL är ett sätt att köra virtuella Linuxmaskiner parallelt med Windows.</p>
</div>
<div class="paragraph">
<p><a href="https://drive.google.com/file/d/1HA6PBlPSEO4k7ZggXLCNBvvMcA45jhXN/view?usp=drive_link">Ladda ner kursens Linux-image</a> (finns även i Classroom). Spara filen som wsp.tar i mappen du skapat för kursen. Packa upp ZIP-filen till en TAR-fil.</p>
</div>
<div class="paragraph">
<p>Starta Windows Terminal som administratör (högerklicka på ikonen och väl "Starta som Administratör")
Navigera till mappen i Windows Terminal och kör nedanstående kommandon, ett i taget.</p>
</div>
<div class="paragraph">
<p>Kan du inte starta som Administratör måste du lägga till ditt konto i Windows så du har rättigheter att köra som admin.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="powershell"><span class="n">dism.exe</span><span class="w"> </span><span class="nx">/online</span><span class="w"> </span><span class="nx">/enable-feature</span><span class="w"> </span><span class="nx">/featurename:Microsoft-Windows-Subsystem-Linux</span><span class="w"> </span><span class="nx">/all</span><span class="w"> </span><span class="nx">/norestart</span><span class="w"> <i class="conum" data-value="1"></i><b>(1)</b>
</span><span class="n">dism.exe</span><span class="w"> </span><span class="nx">/online</span><span class="w"> </span><span class="nx">/enable-feature</span><span class="w"> </span><span class="nx">/featurename:VirtualMachinePlatform</span><span class="w"> </span><span class="nx">/all</span><span class="w"> </span><span class="nx">/norestart</span><span class="w"> <i class="conum" data-value="2"></i><b>(2)</b>

</span><span class="n">wsl</span><span class="w"> </span><span class="nt">--update</span><span class="w"> <i class="conum" data-value="3"></i><b>(3)</b>
</span><span class="n">wsl</span><span class="w"> </span><span class="nt">--set-default-version</span><span class="w"> </span><span class="nx">2</span><span class="w">
</span><span class="n">wsl</span><span class="w"> </span><span class="nt">--unregister</span><span class="w"> </span><span class="nx">Ubuntu</span><span class="w">

</span><span class="n">wsl</span><span class="w"> </span><span class="nt">--import</span><span class="w"> </span><span class="nx">WSP</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="o">.</span><span class="nx">\wsp.tar</span><span class="w"> <i class="conum" data-value="4"></i><b>(4)</b>

</span><span class="n">netsh</span><span class="w"> </span><span class="nx">interface</span><span class="w"> </span><span class="nx">portproxy</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="nx">v4tov4</span><span class="w"> </span><span class="nx">listenport</span><span class="o">=</span><span class="mi">9292</span><span class="w"> </span><span class="n">listenaddress</span><span class="o">=</span><span class="mf">0.0</span><span class="o">.</span><span class="nf">0</span><span class="o">.</span><span class="nf">0</span><span class="w"> </span><span class="n">connectport</span><span class="o">=</span><span class="mi">9292</span><span class="w"> </span><span class="n">connectaddress</span><span class="o">=</span><span class="p">(</span><span class="n">wsl</span><span class="w"> </span><span class="nx">hostname</span><span class="w"> </span><span class="nt">-I</span><span class="p">)</span><span class="w"> <i class="conum" data-value="5"></i><b>(5)</b>
</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Aktivera WSL</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Aktivera stöd för Virtuella Maskiner</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Installera senaste versionen av WSL, ställ in rätt version + avinstallera ev. tidigare versioner av Ubuntu</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Sökvägen till WSP-imagen</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Gör så att datorn forwardar porten till WSP</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Om <code>wsl --update</code> inte fungerar (märks genom att bara instruktionerna för hur wsl används skrivs ut) har du en för gammal version av Windows. Hämta uppdateringar genom att</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Se till att Hyper-V och WSL är igång: Kontrollpanelen &gt; Program &gt; Aktivera eller inaktivera Windowsfunktioner</p>
</li>
<li>
<p>Öppna <code>Inställningar</code> &gt; <code>Updateringar &amp; Säkerhet</code> &gt; <code>Windows Update</code></p>
</li>
<li>
<p>Klicka på "Avancerade Alternativ" (längst ner)</p>
</li>
<li>
<p>Sätt på "Hämta uppdateringar för andra Microsoft-produkter när jag uppdaterar Windows"</p>
</li>
<li>
<p>Gå tillbaks till föregående skärm i inställningar och Klicka på "Check for updates", "Ladda ner" och vänta på att uppdateringarna laddas ner och installeras.</p>
</li>
<li>
<p>Starta om Windows en eller flera gånger allteftersom du blir ombedd. Detta kan ta låång tid och även misslyckas. Prata med mig i så fall.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Slutligen:</p>
</div>
<div class="paragraph">
<p>Starta den virtuella maskinen: <code>wsl</code>.
Användarnamn och lösenord för WSL-imagen: <code>wsl</code></p>
</div>
<h3 id="_visual_studio_code" class="discrete">Visual Studio Code</h3>
<div class="paragraph">
<p>Installera följande extensions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ruby LSP (av Shopify)</p>
</li>
<li>
<p>erb (av Craig Maslowski)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-08-12 12:46:09 UTC
</div>
</div>
</body>
</html>